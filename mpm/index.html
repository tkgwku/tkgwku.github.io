<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>MPM-APDIインプット作成</title>
	<style>
		.hidden{display:none}
		.acol{border:1px solid #d7cce7;background-color:#e4dcf0;}
		.colpick{color:#8973a8}
		.pointer:hover{cursor:pointer}
		.inline-block{display:inline-block}
		.purple{color:#8973a8}
		.hover-purple:hover .purple{color:#7d35d4}
		.hover-purple:hover svg{fill:#7d35d4}
		.hover-purple-svg:hover{fill:#7d35d4}
		.invisible{visibility:invisible}
		.prep1{min-width:100px}
		.prep2{min-width:140px}
		#filecontent,#filecontent_apdi,#filecontent_sncond{min-height:100px;font-family:monospace}
		#mpRadiusRange{width:200px}
		.pastinput {
			padding: 0.25rem 0.75rem;
			background-color: rgba(255, 255, 255, 0.85);
			background-clip: padding-box;
			border: 1px solid rgba(0, 0, 0, 0.1);
			border-radius: 0.25rem;
			color: #8e65c7;
			margin-bottom: .25rem;
			cursor: pointer
		}
		.pastinput:hover {
			opacity: .8
		}
		.pastinput.disabled {opacity: .5}
	</style>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
	<style>
		.btn-outline-primary {
			color: #8e65c7;
			background-color: #fff;
			border-color: #8e65c7;
		}
		.acol .btn-outline-primary {
			background-color: #faf5ff;
		}
		.btn-outline-primary:hover {
			color: #fff;
			background-color: #8e65c7;
			border-color: #8e65c7;
		}
		.btn-outline-primary:focus, .btn-outline-primary.focus {
			box-shadow: 0 0 0 0.2rem rgba(100, 53, 166, 0.5);
		}
		.btn-outline-primary.disabled, .btn-outline-primary:disabled {
			color: #8e65c7;
			background-color: transparent;
		}
	</style>
</head>
<body>
	<div class="container pb-4">
		<h1 class="mt-4 mb-4">MPM-APDIインプット作成</h1>
		<div class="row">
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addMP-fromXY">
				<div title="マテリアルポイント追加" >
					<div class="inline-block purple">粒子座標からMP追加</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addMP-fromGrid">
				<div title="マテリアルポイント追加" >
					<div class="inline-block purple">格子情報からMP追加</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addNCOND">
				<div title="境界条件追加" >
					<div class="inline-block purple">境界条件追加</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addAPDI">
				<div title="APDI要素を追加 (正方形)" >
					<div class="inline-block purple">APDIを追加 (正方形要素)</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addAPDIxbuffer">
				<div title="APDIを追加 (縦長バッファー要素)" >
					<div class="inline-block purple">APDIを追加 (縦長バッファー要素)</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
			<div class="pointer col-sm pt-1 acol hover-purple" id="toggler-addAPDIybuffer">
				<div title="APDIを追加 (横長バッファー要素)" >
					<div class="inline-block purple">APDIを追加 (横長バッファー要素)</div>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-plus" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					</svg>
					<svg height="40" viewBox="0 0 16 16" class="bi bi-minus hidden" fill="#8973a8" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
					</svg>
				</div>
			</div>
		</div>
		<div id="inputs-div">
		</div>
		<div id="toggle-addMP-fromXY" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">粒子座標からMP追加</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">材料番号</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1" id="MPmat-fromXY">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.25" id="MPx1-fromXY">
						<input type="text" class="form-control" placeholder="例：0.25" id="MPy1-fromXY">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：11.75" id="MPx2-fromXY">
						<input type="text" class="form-control" placeholder="例：26.75" id="MPy2-fromXY">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">間隔</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.50" id="MPinterval-fromXY">
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addMP-fromXY">
				</div>
				<div class="col-sm pt-3 pb-3 acol" id="pastinput-addMP-fromXY">
				</div>
			</div>
		</div>
		<div id="toggle-addMP-fromGrid" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">格子情報からMPを追加</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep2">材料番号</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1" id="MPmat-fromGrid">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep2">格子の始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.00" id="MPx1-fromGrid">
						<input type="text" class="form-control" placeholder="例：0.00" id="MPy1-fromGrid">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep2">格子の終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：12.00" id="MPx2-fromGrid">
						<input type="text" class="form-control" placeholder="例：27.00" id="MPy2-fromGrid">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep2">格子幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.0" id="MPgridWidth-fromGrid">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep2">格子内MP数</span>
						</div>
						<input type="text" class="form-control" placeholder="例：4" id="MPnumInGrid-fromGrid">
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addMP-fromGrid">
				</div>
				<div class="col-sm pt-3 pb-3 acol" id="pastinput-addMP-fromGrid">
				</div>
			</div>
		</div>
		<div id="toggle-addNCOND" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">境界条件の追加</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text">始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.00" id="ncond_x1">
						<input type="text" class="form-control" placeholder="例：1.00" id="ncond_y1">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text">終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.00" id="ncond_x2">
						<input type="text" class="form-control" placeholder="例：26.00" id="ncond_y2">
					</div>
					<div>
						<input type="radio" value="sncond_x" name="sncond_fix" id="sncond_x">
						<label class="pointer" for="sncond_x">X固定</label>
						<input class="ml-3" type="radio" value="sncond_y" name="sncond_fix" id="sncond_y">
						<label class="pointer" for="sncond_y">Y固定</label>
						<input class="ml-3" type="radio" value="sncond_xy" name="sncond_fix" id="sncond_xy">
						<label class="pointer" for="sncond_xy">XY固定</label>
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addNCOND">
				</div>
				<div class="col-sm pt-3 pb-3 acol" id="pastinput-addNCOND"></div>
			</div>
		</div>
		
		<div id="toggle-addAPDI" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">APDIの追加 (正方形要素)</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">材料番号</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1" id="apdi_mm">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.00" id="apdi_x1">
						<input type="text" class="form-control" placeholder="例：2.00" id="apdi_y1">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：11.00" id="apdi_x2">
						<input type="text" class="form-control" placeholder="例：18.00" id="apdi_y2">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">要素幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.40" id="APDIgridWidth">
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addAPDI">
				</div>
				<div class="col-sm pt-3 pb-3 acol" id="pastinput-addAPDI"></div>
			</div>
		</div>
		
		<div id="toggle-addAPDIxbuffer" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">APDIを追加 (縦長バッファー要素)</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">材料番号</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1" id="apdibx_mm">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.00" id="apdibx_x1">
						<input type="text" class="form-control" placeholder="例：2.00" id="apdibx_y1">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：11.00" id="apdibx_x2">
						<input type="text" class="form-control" placeholder="例：18.00" id="apdibx_y2">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">左側要素の要素幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.40" id="APDIgridWidthbxleft">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">右側要素の要素幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.40" id="APDIgridWidthbxright">
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addAPDIxbuffer">
				</div>
				<div class="col-sm pt-3 acol" id="pastinput-addAPDIxbuffer"></div>
			</div>
		</div>
		
		<div id="toggle-addAPDIybuffer" class="hidden">
			<div class="row mt-4">
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">APDIを追加 (横長バッファー要素)</div>
				</div>
				<div class="col-sm acol pt-2">
					<div class="purple mb-2">追加されているMP</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm pt-3 pb-3 acol">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">材料番号</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1" id="apdiby_mm">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">始点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：1.00" id="apdiby_x1">
						<input type="text" class="form-control" placeholder="例：2.00" id="apdiby_y1">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">終点XY</span>
						</div>
						<input type="text" class="form-control" placeholder="例：11.00" id="apdiby_x2">
						<input type="text" class="form-control" placeholder="例：18.00" id="apdiby_y2">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">上側要素の要素幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.40" id="APDIgridWidthbytop">
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text prep1">下側要素の要素幅</span>
						</div>
						<input type="text" class="form-control" placeholder="例：0.40" id="APDIgridWidthbybottom">
					</div>
					<input class="btn btn-outline-primary" type="button" value="適用" id="submit-addAPDIybuffer">
				</div>
				<div class="col-sm pt-3 acol pb-3" id="pastinput-addAPDIybuffer"></div>
			</div>
		</div>
		
		<div>
			<div class="purple mb-2 mt-3">マテリアルポイント(input_mp.dat) 内容</div>
			<textarea class="form-control" placeholder="ファイル内容はここに表示されます" id="filecontent" onclick="this.focus();this.select()" readonly="readonly"></textarea>
			<input class="btn btn-outline-primary mt-2" type="button" value="input_mp.datを保存" id="savefile">
		</div>
		
		<div class="mt-4">
			<div class="purple mb-2">境界条件(config.datの一部) 内容</div>
			<textarea class="form-control" placeholder="ファイル内容はここに表示されます" id="filecontent_sncond" onclick="this.focus();this.select()" readonly="readonly"></textarea>
		</div>
		
		<div class="mt-4">
			<div class="purple mb-2">APDI入力ファイル(input_apdi.dat) 内容</div>
			<textarea class="form-control" placeholder="ファイル内容はここに表示されます" id="filecontent_apdi" onclick="this.focus();this.select()" readonly="readonly"></textarea>
			<input class="btn btn-outline-primary mt-2" type="button" value="input_apdi.datを保存" id="saveapdifile">
		</div>
		
		
		<div class="mt-4 purple">プレビュー (未実装)</div>
		
		<div class="form-group ml-2">
			<label for="formControlRange" class="purple mt-2">MP表示ピクセル数: <span id="mpRadiusPx">2</span>px</label>
			<input type="range" class="form-control-range pointer" id="mpRadiusRange" min="0" max="7" value="1">
		</div>
		<div id="MPcanvas-wrapper" class="mt-3" style="position:absolute">
			<div id="MPcanvas" width="100px" height="100px"></div>
		</div>
		<div min-height="200px" id="MPbackground"></div>
		
		<div class="mt-4">
			<div class="purple">※バッファ要素について</div>
			<div class="row mt-4">
				<div class="col col-sm-2"><img src="buffer.png" width="100%"></div>
				<div class="col col-sm-auto purple pt-4">左図のような形のAPDI要素をバッファ(Buffer)要素として用いる.<br>バッファ要素の左右で要素幅が倍になっている.</div>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<script src="js/components.js"></script>
	<script src="js/mp.js"></script>
	<script src="js/apdi.js"></script>
	<script src="js/ncond.js"></script>
	<script src="js/mp_canvas.js"></script>
	<script src="js/debug.js"></script>
	<script src="js/io.js"></script>
	<script type="text/javascript">
		$(function(){
			initLS()
			$("#toggler-addMP-fromXY").on('click', function(){
				if ($("#toggle-addMP-fromXY").hasClass("hidden")){
					$("#toggle-addMP-fromXY").prependTo("#inputs-div")
				}
				$("#toggler-addMP-fromXY .bi-plus").toggleClass("hidden")
				$("#toggler-addMP-fromXY .bi-minus").toggleClass("hidden")
				$("#toggle-addMP-fromXY").toggleClass("hidden")
			});
			$("#toggler-addMP-fromGrid").on('click', function(){
				if ($("#toggle-addMP-fromGrid").hasClass("hidden")){
					$("#toggle-addMP-fromGrid").prependTo("#inputs-div")
				}
				$("#toggler-addMP-fromGrid .bi-plus").toggleClass("hidden")
				$("#toggler-addMP-fromGrid .bi-minus").toggleClass("hidden")
				$("#toggle-addMP-fromGrid").toggleClass("hidden")
			});
			$("#toggler-addNCOND").on('click', function(){
				if ($("#toggle-addNCOND").hasClass("hidden")){
					$("#toggle-addNCOND").prependTo("#inputs-div")
				}
				$("#toggler-addNCOND .bi-plus").toggleClass("hidden")
				$("#toggler-addNCOND .bi-minus").toggleClass("hidden")
				$("#toggle-addNCOND").toggleClass("hidden")
			});
			$("#toggler-addAPDI").on('click', function(){
				if ($("#toggle-addAPDI").hasClass("hidden")){
					$("#toggle-addAPDI").prependTo("#inputs-div")
				}
				$("#toggler-addAPDI .bi-plus").toggleClass("hidden")
				$("#toggler-addAPDI .bi-minus").toggleClass("hidden")
				$("#toggle-addAPDI").toggleClass("hidden")
			});
			$("#toggler-addAPDIxbuffer").on('click', function(){
				if ($("#toggle-addAPDIxbuffer").hasClass("hidden")){
					$("#toggle-addAPDIxbuffer").prependTo("#inputs-div")
				}
				$("#toggler-addAPDIxbuffer .bi-plus").toggleClass("hidden")
				$("#toggler-addAPDIxbuffer .bi-minus").toggleClass("hidden")
				$("#toggle-addAPDIxbuffer").toggleClass("hidden")
			});
			$("#toggler-addAPDIybuffer").on('click', function(){
				if ($("#toggle-addAPDIybuffer").hasClass("hidden")){
					$("#toggle-addAPDIybuffer").prependTo("#inputs-div")
				}
				$("#toggler-addAPDIybuffer .bi-plus").toggleClass("hidden")
				$("#toggler-addAPDIybuffer .bi-minus").toggleClass("hidden")
				$("#toggle-addAPDIybuffer").toggleClass("hidden")
			});
			$("#submit-addMP-fromXY").on('click', function(){
				let mm = parseInt($("#MPmat-fromXY").val())
				let x1 = parseFloat($("#MPx1-fromXY").val())
				let y1 = parseFloat($("#MPy1-fromXY").val())
				let x2 = parseFloat($("#MPx2-fromXY").val())
				let y2 = parseFloat($("#MPy2-fromXY").val())
				let interval = parseFloat($("#MPinterval-fromXY").val())
				addMP_fromXY(mm,x1,y1,x2,y2,interval)
				convertMP()
				convertInputAPDI()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "mm="+mm+",x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",interval="+interval)
					.html("[MP] 材料番号: "+mm+", 粒子座標("+x1+", "+y1+")から("+x2+", "+y2+")まで, "+interval+"おき")
					.prependTo("#pastinput-addMP-fromXY")
			});
			$("#submit-addMP-fromGrid").on('click', function(){
				let mm = parseInt($("#MPmat-fromGrid").val())
				let x1 = parseFloat($("#MPx1-fromGrid").val())
				let y1 = parseFloat($("#MPy1-fromGrid").val())
				let x2 = parseFloat($("#MPx2-fromGrid").val())
				let y2 = parseFloat($("#MPy2-fromGrid").val())
				let gridWidth = parseFloat($("#MPgridWidth-fromGrid").val())
				let numInGrid = parseInt($("#MPnumInGrid-fromGrid").val())
				addMP_fromGrid(mm,x1,y1,x2,y2,gridWidth,numInGrid)
				convertMP()
				convertInputAPDI()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "mm="+mm+",x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",gridWidth="+gridWidth+",numInGrid="+numInGrid)
					.html("[MP] 材料番号: "+mm+", 格子座標("+x1+", "+y1+")から( "+x2+", "+y2+")まで, 格子幅: "+gridWidth+", 各格子に"+numInGrid+"粒子ずつ")
					.prependTo("#pastinput-addMP-fromGrid")
			});
			$("#submit-addAPDI").on('click', function(){
				let mm = parseInt($("#apdi_mm").val())
				let x1 = parseFloat($("#apdi_x1").val())
				let y1 = parseFloat($("#apdi_y1").val())
				let x2 = parseFloat($("#apdi_x2").val())
				let y2 = parseFloat($("#apdi_y2").val())
				let gridWidth = parseFloat($("#APDIgridWidth").val())
				addSquareAPDI(mm, x1,y1,x2,y2,gridWidth)
				convertInputAPDI()
				convertMP()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "mm="+mm+",x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",gridWidth="+gridWidth)
					.html("[APDI] 材料番号 : "+mm+", 座標("+x1+", "+y1+")から("+x2+", "+y2+")まで, 幅 : "+gridWidth+"の正方形格子")
					.prependTo("#pastinput-addAPDI")
			})
			$("#submit-addAPDIxbuffer").on('click', function(){
				let mm = parseInt($("#apdibx_mm").val())
				let x1 = parseFloat($("#apdibx_x1").val())
				let y1 = parseFloat($("#apdibx_y1").val())
				let x2 = parseFloat($("#apdibx_x2").val())
				let y2 = parseFloat($("#apdibx_y2").val())
				let width_left = parseFloat($("#APDIgridWidthbxleft").val())
				let width_right = parseFloat($("#APDIgridWidthbxright").val())
				addVerticalAPDIBuffer(mm,x1,y1,x2,y2,width_left,width_right)
				convertInputAPDI()
				convertMP()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "mm="+mm+",x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",width_left="+width_left+",width_right="+width_right)
					.html("[APDI] 材料番号 : "+mm+", 座標("+x1+", "+y1+")から("+x2+", "+y2+")まで, 左側要素の要素幅 : "+width_left+", 右側要素の要素幅 : "+width_right+"の縦長バッファ要素")
					.prependTo("#pastinput-addAPDIxbuffer")
			})
			$("#submit-addAPDIybuffer").on('click', function(){
				let mm = parseInt($("#apdiby_mm").val())
				let x1 = parseFloat($("#apdiby_x1").val())
				let y1 = parseFloat($("#apdiby_y1").val())
				let x2 = parseFloat($("#apdiby_x2").val())
				let y2 = parseFloat($("#apdiby_y2").val())
				let width_top = parseFloat($("#APDIgridWidthbytop").val())
				let width_bottom = parseFloat($("#APDIgridWidthbybottom").val())
				addHorizontalAPDIBuffer(mm,x1,y1,x2,y2,width_top,width_bottom)
				convertInputAPDI()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "mm="+mm+",x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",width_top="+width_top+",width_bottom="+width_bottom)
					.html("[APDI] 材料番号 : "+mm+", 座標("+x1+", "+y1+")から("+x2+", "+y2+")まで, 上要素の要素幅 : "+width_top+", 下要素の要素幅 : "+width_bottom+"の横長バッファ要素")
					.on('click', function(e){
						return//
						let _s = $(e.target).attr("data-inputs").split(",")
						let dict = {}
						for (let i=0;i<_s.length;i++){
							let _a = _s[i].split("=")
							dict[_a[0]] = _a[1]
						}
						let mm = parseFloat(dict["mm"])
						let x1 = parseFloat(dict["x1"])
						let y1 = parseFloat(dict["y1"])
						let x2 = parseFloat(dict["x2"])
						let y2 = parseFloat(dict["y2"])
						let width_top = parseFloat(dict["width_top"])
						let width_bottom = parseFloat(dict["width_bottom"])
						
						if ($(e.target).hasClass("disabled")){
							addHorizontalAPDIBuffer(mm,x1,y1,x2,y2,width_top,width_bottom)
							convertInputAPDI()
							drawRect()
							$(e.target).removeClass("disabled")
						} else {
							removeHorizontalAPDIBuffer(mm,x1,y1,x2,y2,width_top,width_bottom)
							convertInputAPDI()
							drawRect()
							$(e.target).addClass("disabled")
						}
					})
					.prependTo("#pastinput-addAPDIybuffer")
			})
			$("#savefile").on('click',function(){
				saveAsFile("input_mp.dat",$("#filecontent").text())
			})
			$("#saveapdifile").on('click',function(){
				saveAsFile("input_apdi.dat",$("#filecontent_apdi").text())
			})
			$("#submit-addNCOND").on('click', function(){
				let x1 = parseFloat($("#ncond_x1").val())
				let y1 = parseFloat($("#ncond_y1").val())
				let x2 = parseFloat($("#ncond_x2").val())
				let y2 = parseFloat($("#ncond_y2").val())
				let fix = $("input[name=sncond_fix]:checked").val()
				addNCOND(x1,y1,x2,y2,fix)
				convertNcond()
				drawRect()
				$("<div>")
					.addClass("pastinput")
					.attr("data-inputs", "x1="+x1+",y1="+y1+",x2="+x2+",y2="+y2+",fix="+fix)
					.html("[Boundary] 格子座標("+x1+", "+y1+")から("+x2+", "+y2+")まで, "+fix.substring(7,fix.length)+"軸固定")
					.on('click', function(e){
						let _s = $(e.target).attr("data-inputs").split(",")
						let dict = {}
						for (let i=0;i<_s.length;i++){
							let _a = _s[i].split("=")
							dict[_a[0]] = _a[1]
						}
						let x1 = parseFloat(dict["x1"])
						let y1 = parseFloat(dict["y1"])
						let x2 = parseFloat(dict["x2"])
						let y2 = parseFloat(dict["y2"])
						let fix = dict["fix"]
						
						if ($(e.target).hasClass("disabled")){
							addNCOND(x1,y1,x2,y2,fix)
							convertNcond()
							drawRect()
							$(e.target).removeClass("disabled")
						} else {
							removeNCOND(x1,y1,x2,y2,fix)
							convertNcond()
							drawRect()
							$(e.target).addClass("disabled")
						}
					})
					.prependTo("#pastinput-addNCOND")
			})
			$("#mpRadiusRange").on('change', function(){
				setRadius($(this).val())
				if (MPcount > 0){
					drawRect()
				}
				localStorage.setItem("mpRadiusRange",$(this).val()+"")
			})
		});
		
		function initLS(){
			$("input[type=text]").each(function(event, elem){
				if (elem.hasAttribute("id")){
					$(elem).on('change', function(ev2){
						let id = $(ev2.target).attr("id")
						let val = $(ev2.target).val()
						localStorage.setItem(id, val)
					});
					let ls = localStorage.getItem($(elem).attr("id"))
					if (ls) {
						$(elem).val(ls)
					}
				}
			})
			$("input[type=radio]").each(function(event, elem){
				if (elem.hasAttribute("name")){
					$(elem).on('change', function(ev2){
						let name = $(ev2.target).attr("name")
						let val = $("input[name="+name+"]:checked").val()
						localStorage.setItem(name, val)
					});
					//無駄に三回実行されるけどまあいいや
					let ls = localStorage.getItem($(elem).attr("name"))
					if (ls) {
						$(elem).val([ls])
					}
				}
			})
			let lvalRad = localStorage.getItem("mpRadiusRange")
			if (lvalRad) {
				$("#mpRadiusRange").val(parseInt(lvalRad))
				setRadius(parseInt(lvalRad))
			}
		}
	</script>
</body>
</html>