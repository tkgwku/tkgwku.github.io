var STAR_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVQ4jbWSPUtcQRiFn5m7Gw1W22gKPzBZQgIhojbWaZSQSvBjN/4Fq9hIIGKqqIWdoIWVGqysbERII7sQ7UQwATWwRQJREVbEXGfmpBDCZpe7YOHAKWbmzPO+Z2bgPodmGXcfydfzpOoSXjAS/eEMWLt79TwZ7SPt4ZWlIclnEwnPGeUp8AzrRxi8O6CbHA+AJoh6yCXZjKbo4zFLoY3YCoOwBCBLF60gMOYEH35wYCMMBkMKwxGNfOf1bd5PDOsr1xKSQ7pBiit0UyGHVKCsafr/a0VjNPvP7OgU+TLB/Sa4nwT3i+BOCf6KoDOkVb4oTyYxumb44PZQ/I1QKVdEmmOy2l/7D8ochhQEVd8WROcUqu01rxCekNfD2wP2AmMvMRhQBujgbV2Aekn7Zt5gITrGpbfIpbcZj0oYLLhHDCdmB9A0Q/Eucisc6h2d/9YneOnWKcVFpPe8SgbMs+kXWBaYmr0BGvwiG36OlWTAJC11WwQ0RXvl/C8G2bIkQqHCOgAAAABJRU5ErkJggg==",UNSTAR_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAABl0lEQVQ4jZ1RMWsUQRh9726JP8DO4q4y+AtU0IBNSKloEWKIMLMDh4VNiPWyIGlSSDq5Y7/JFVG5QgVBEEVBiDYKQgpJeX0g1TW77HwpvCOXc29FXzXzvfe9730zQA2SJGnU8QBQK2i1WrsiktRpojqS5BUA4b8SZFl2jeQBgKNut7v4zwYkN4qieK6q+1EUPahLUQkR+Vx1nkUkIpsAtgB8BXABAFU1ArA3leaViLwjWQJQVc0BrKiq4XjCEwCXrLX2b8kGg0FzNBrtl2X5wzm3wwnhvb+uqk9DCI+cc9+rmnu93tVms7lL8qEx5icAcFqQJMlCu91+CcBba9/OvMkqyXt5nq93Op1iUj/3C2ma5gAOQwjHFQEKAJ+mm/8wGGPJOfdtPPW29/4WAAyHwzchhDuz4nMGInKZ5C8A8N4/I3kTwEaWZdtpmgaSJ/1+/+JcA1VdU9UD7/0XVX1tjHlsjIkBHIrIB1X9WJbl2lyDRqNxn6TJ8/yutfb9pB7H8YuiKGKSDsB6xdq/4b2/MZc8W3N5+n4KbVypv8PDMtkAAAAASUVORK5CYII=",LARGE_STAR_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAADl0lEQVRYhdWXXWgcZRSGn/PNzKaxsWk20WJWK7alYOmPf+CV4KVgSEqapJvgDyiIYG+8EMSb6IV45Z0WCr0QQSyJ2WwIothS9bIiSFNIrW2jMcEqFetfzf7MnONFdpOJ3U02u5riCx8z8/Gd932/98wMM/B/xqfD+DfVgE2QibK83giHq1t8GF+bedwFDN4UAxyg26VI0ME9+RMc2HgDQppOIAV+QLpunnrw5XMEdpKcGmYhFk3y3YYasAy9dg4zQ81QO4PlT/BAPVz1tUAYJBW7TkEi0djNWDPsGIF9Ql4tlkCERZPM1cO37gTCdrrpJCFgMRZz27izMMpD/7kB35FeEX8ZKQj89bfBt2MEegdvOiNUxWGIA0FwgMNwKjgniCrQQpe1gkTEM8BuAwl42jK0KngIUt6dsniuhjgHJe6C9PCMANgE79HEEPuB4B8WpaxQOjSDNMWlY/gLoRCrEVZm7IDrwFmICrzi9/BGeSmWpY9NvMODbKYjJqAl8cqStcGVxjyiZ7niChyUXr6I72/RxBi3q8cHbgeP2F4QxRoSLvMqIlPAHGOEPCkDLKxekOElO43Zr5iFqBVXjiiPRrnSyKNWuHGNFVELUfsFs5MUbZxnK2lJpUmA/Aj7/E2Muz3s1O2YFcFCIASLt6WckAPxQQKQBDgPmEH4mvPk6JYBLq3LAIAN47iPty3J89FuzBy13QsR+DOIXeWo18uR1apWNbBkZIwXtJO3wh0YGpuvROQgmEbkGkPSy/trcdf2InLcrVsWozdbHvE2LM0raAtE4NVGXQt80rqV2uI30HbwHEP/ioH8KPdrK3eZqyAvVGyiNoPewmP2LpsbNpAIOKxJbti9GBJcRvx5pIIJszYkaqGvYQPqcVjb4srgFhB/iqL9xBPePK8F04iEMSPLbVjzU231x3CcfZpkqri79EYU8H5E/DnOU6BL+pgBKI7yqGtmTHeSjLYurZXgHPbzN2zZdoQ/60pAjbQmS04VCS4g/izHX+1mb1kcIOjnsz9+Y5d/gdP+7HIOlkTaOzm0VgrVE5jkYv4HrHAJiz5iwTL0r1mT5WU9heVnscK3mGX5uC7x3Ah7os+x4ldYNMGUjbC91trCKA/bJFeK01h0Crt6nFurra3agqYmBuV3cLMc9XrYLwN8X6uBRD9nuMYud5EPJQdtHdWfhqo/l5FQ9JRD7iCZWoXjkKe4DnSFWV4U4d56ODYEfwM1wpRyzU0yVAAAAABJRU5ErkJggg==",LOOP_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEIklEQVRYhe2WT2hcVRTGv3PvPJ0OJkEXHUQXJrZRGiYoQi2CzsIiQUycJLwZNRrBZtOA0KXtLhW7srpzI120qOC8TCaFKQScCtFF6cIWJMlALEIjNCa1U9KEQfLuPcdF3ivPOJ38m509q/d499zv9+4997sHeBj/96Bd5GjXdQ8R0YsAUgAOArgFYAZApVqtXiuXyytNB+jv73/ScZxTAIatta0AQEQg2phCRCAiiMViEJHL1tqxQqHwc1MAXNc9TkSfM3NCa/0vQRG5D6GUAgAwM5gZWuvztVpttFQq1XYF0NPT82hbW9s5Y8xQLBa7P7mIQCm1AOAKgAUAMQCdAF611rZqrUFEsNZCKXVTRI56nndjxwC5XO6bqLgxBlrrS9baTwuFwtU6Kcp13RwRnWHmZ7TWYGYQ0R3f91PFYnFx2wCu6x5n5q+CPQUAX0Q+8Dzv+0bQAJBOp2PJZPKCtfbdWCwWQlzN5/NHtgUQFNwNIkoAgIgYAK/n8/mfthKPRjab/ZaZ39NawxgDpdSI53nnomNUvUTHcU4xcwLYWHYRGd2pOAAsLS19qJT6XUQQ1MUZbPrpegAawLDWGkHiL57nfb1TcQCYnp42zPyJtTYsyv2Dg4P9DQFc1z0UnvOg4s/uRjyM8fFxT2tdDU4OtNZ9DQECh9v4qJRZXV29tBeAIH6I+MXhhgAAUkQUmsxvU1NT9/aqLiLXIwAHEKmDegAHQwAi+mOv4kHcDR+Y2clkMs83ArgFbPi8iDjNUKfQq4N5Hcf5qxHATGA8IKLOZgAAeBZAuKrLnufdbgRQiezXU67rHtiNYl9fX0vk9TWlVOioM9Fx/wGoVqvXNl08wzsVz+Vy5+Px+L1sNvtxJpPpJKLDYV0BKDcEKJfLKyJyObhOoZQ60dvbm9yB+BvGmOFgFV9xHGeMmQkAlFLi+/7WVmytHWNmAICItOzbt+87bLN3EJEvAnCICBPRO0opWGsB4EKxWFyOjtf1JqlUKgupVKqdmV8IrtT2rq6ulzo6Oi7Oz8/7DxLPZrMj1tpjQdOySkTdRKQDF1wTkbfn5ubWtlwBAKjVaqNKqZvhVojIW4lEYmZgYGCw3vh0Oh0H8FnYMQFoAfAIAFhrYYx53/O8PzfnPRCgVCrVROQoEd0JIQC0K6XGs9nsguu6H0XHJ5PJk8y8P3LkASC80E4XCoWL9XS23NegNyhaa18OWy0RATPDGPPc5OTk/NDQUKvv+0tEFN+cLyJ3ReQKES2KyMmoBzRcgTCKxeJiPp8/opQaAbAc9AfhkdIAsL6+/rQxJh5tVEMzA/A4gDd93z9GRCc2z1+3COvF3Nzc9dnZ2bPd3d2/Algjoi8nJiZ+DL7dTqVSjwF4AsAKgBqAvwFYAKKUIqVU1Vp7ulKpNOt+eRjNiX8AU0QYjp7wU7cAAAAASUVORK5CYII=",NOT_LOOP_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE/klEQVRYheWWTWxUVRTH/+fembZSGKILKmhMMBhMysKNH0BrTTRxYozJGO4dxMAG1FgViQlRiAs/ojEGkGhMDAYXLIhz3wytVEijDVFZqImGENviFwtSFS1gW2dR0nn3HBe8h6+vM4MYw0LPaua9c87vf+8995wH/N+NriTMGPMEEW0FcNg513tFBRhjnmXm17TWCMMQbW1t1+zfv3/isgXk8/nW9vb2lVrrLgBLAXSIyCQRjQEYnp6eHhoYGPitHjyTyYCZQURjzrkbgMvYgUKhsDibzW4HsMF7nyMiEP0VLiIQEWQyGYjIESJ6oVQqHTXGbGXm16PnIKJxZl4dBMGPf1uAMeZxItrBzPO01rOAUVIAgFIKAMDMEBEopT4VkR6lVOx3hplXxfBLCsjn8625XO497/26TCaTTn4KwBcicoqIsgBuAnCn9z4X+8biRAQAxkVkdRIOAJlmAtLwMAyhtT7EzC87576sE6KMMWsA7AGwMN6Z6NwfSsObCrDW9sbwaCUzSqkNzrlSE81MREtEZGGyPpRSIKJXAKxMB+h6WQqFwmKt9Yda62z0KARwTxAEh5vAYYx5hpl3aa1nbT8RIQzD61esWPHT6OjosWSMqpcom81uZ+Z5wIVtF5Fe59xnzeDW2i3MvDPeMQDnROQWACdFBFprENGrSNXdHAH5fL4VwIZ4FVrrr4IgePdScO/9Gyn4aufccWbe5r0HEcF7v6hYLBaaCliwYMEd3vsccLHidzWDF4vFp5NwIvo9qvbvAKBcLgda63PRzYGIPNBUgFKqK3Gvw2q1eqgZPAzD3Ul4rVa7CE/YUKJf3NZUgIgsjYtHRH4YHBz8ox7cGFMXfuDAgW/r5DyWELDMGNPSUACAjigIUX+fY9bap0Rkd+LMJwB01YNHNhH/YOYsM9/cTMAkgPgKZdMvjTFPMvObcZECmBSRrlKpdKIBHJRoCkSEWq12tqEAERmLEgPA8jRcRN5KwCeighttBI9sWZQbRDR+8ODBXxoKADAcnxcRLTHGLAMudMYUfNJ7390Ins/nc4m/3fFAAjCc9JvTisMwHGppaREAxMxQSj1sjDnNzG+n4F2VSmWkHtxau09E1ltrN58/f/4jIroduHCtlVIfJ33rTkNr7ZCI3B2N12kRuSrRVqdmZma6+vr6hhvE3uu9H1RKQSn1PjMDwNpoB0REOoIgOBP7123F3vsXE3UwC87M3Y3gke3UWsdNh4lorVIK3nsA2JeENxRQqVSOaq2HEiIAAMx8fxAE3zQiW2s3ee87o6KvEtGaWLxSqioiz6Vj6k5Da+1jADYnRyoAENFdnZ2dP4+MjMy5cj09PW3z588fUEq1R3GtcX7vPUSkWC6Xv07HzdkBY8yjzPxOrDwKjrvYjcxcttaOGWM2JuM6Ojq2MfOitOho9S9VKpUP6i12lrcx5hER2ZOY51Misg7A8977ldFIhYiAmRGG4fL+/v7vjTELiehXImpLA0Rkgog+F5HTIrKtYQ1Ya29NwgFURaTHOXfYObdKKbUJwHj0fRD7xEd4XRiGbckP1UT9XM3M99VqtY1EtKXhEYhIPl4ZgCqAbufc8fh9EAR7nXPXKqUeJKK9Sqn1/f39J6J3o5lMZgeAEwBOAhgDMA5gioimiSjMZrNnvfdzJuvFIzDGLCWiTwBM12q1Yl9f3/G08z80MsaoIAj8v5TvP2Z/An2SEK7JPoIZAAAAAElFTkSuQmCC",WIDEN_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFZklEQVRYhe1WXWgcVRT+zp3pZptmk9B2GxchaAzJQmhRBINg8S/YVkTfbDckFioEoQq+ak13t1j/Kr4UIywUCulCXFa21oIFqw99qXkQKXbphlisNXatIcJu2zU/c+/nw85sp5Ok8alPPS9z586Zc77znXPPPcB9uS/3WEiK/11yuZxVKBS6AHQZY5T3QSklJEVEGNz31v59EVEiQpLiOfHb8PaVUgbA9Ugk8ksmk6nI4ODgVsdxPhCRPgAagLMKeAFA97lmlJ5TF1xwPaeUmohGoxnbcZxtIrKN5CYRmQdwy+eIazlbwflt7+6TpMeSAFgPoJ3ky3Nzc6dsH4ULAC6SPA9Ae1STNJ4tH5XGfVckjc+/ERHPkfF8iohnQ5EcEJFuAFu01g/aqNO+4Br9vr29/aNYLKaDkfX19cnk5GS4paVFA1hcKfpyuRyORCLS398/XywWl7FXLpetSqXSBKATQEgp1W4rpYwxhi4LTiwW0+l02h8VksmkKhQKjxtjnhKR3zZu3Pjd2NjYTb9OIpHYTHJnpVLZUi6Xf8hmsxdEhAE7qFarNTctimSz8h+L4BFxf7KnpqZeMMZ8SDJB8sVqtRoN6mmtO0nuBDCktT6cSCSeSCaTKqjnppRumtYpd71iZSeTyVCpVHrVGDMKoEdE2gDUmpqaKkFdEZl1i7id5FaS709PTz+dy+WsIFavNo0x9M4uXboa1I+MjDSXSqVBAG+LSCfqeZ+0bXvs2LFj/wQBTExMzAD4HMBFETEAerTW7xYKhYEAiEawIqKU20DEz8TIyEhztVp9DcCbAGIA5gF8GwqFDmSz2amV2BIRTkxM/GxZ1gER+RGAJtlrjHnn5MmTz/pAePVWb0xuXugrmFC1Wn2d5H4ADwC4CeC0bduHx8fHr67k3C/ZbPaiZVmHROS8iDgAuh3HOVgoFAYAKH9higiVdwJcIOby5csxkjsAdACwAJwJh8MfZ7PZ8lrOPaMnTpy4ZFnWIQAXAIRE5GGt9UszMzOtAd1lKVAk5wH86zYYArCUUsv6wlogHMepicgN3Kaczc3Nd7T5Rgp8G+zu7p4VkXERuYp6k9pVq9VGh4eHO/8vgN27dz9E8j2ST6JevFcAfL19+/Zbrs0G0OApIADT29t7hmQGwHUAYQC7FhcXR13Dq15GJCWRSMQBHATwPIAwyT8BfNHW1nauWCySZCNoY4xSxhjl6wMCAOl0erGjo2McwGcAZlwQzwEYHR4efuQuzh81xhwC8AyAEIA/LMs6Eo/H85lMZslT9fsKVmWjDxw9enQhHo/nARwB8DsAG0D/0tJSYmhoaEMQwL59+zYbY94A8BgAS0SmlVKfRCKRU+l0ehEAUqmU12s8trGsVfolnU4vtrW1fQPgCMkigGvugBIK6tZqtQ0i4pD8G8AFy7LSPT09p32RI5VKeb1G6vGKst3Kb9AYNJzJZJZyudzpfD5/BUCPMeZSb2/vslYcj8evTU9Pf2mMOS8ik9ls9tfgZZRKpZhIJDwGAACyZ8+ehDEmhfr1mGltbf10YGDAAECxWGRfX18DVDQaldnZ2VWHlGg0KgCwms7Zs2dVpVJ5C8B+1FNx2Ca54J6E9SR3VCqVTfl8Xjz0pVJJeSONf9IB4A0mXhrvGNf8Ixhup1oAbAPQQvKGUkrZSqkZrfUc6rdYHECXa2BZBL5ULdtrUOqC9H/337Yk14mIJSK3SM7ZlmUVjTFfAXgFwCY3sgYDq63vJq6O5/SOtfvthoicsyzrJwGAvXv3hh3H6SK52V+I/tnS29NaN9ZKKa6kq7WmZVmitaZSisYYUUrRbe9aRG6GQqG/jh8/vqyY78s9l/8ALHgpReHZ3pAAAAAASUVORK5CYII=",NARROW_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFKUlEQVRYhe1WTWxUVRg95775gUppBUukCNaG0CYEtorGTTHBGMJP6YahpLrpVsICI0FHElOJMeJGks6qwgRsDSmBGIOkC0hIidGVGGaiUQIqbUhLZ6CVYd69x8W8V17H/iCJrvg273v33XfP9537ne9e4Ik9sf/ZJDH6zoGBAW9wcLAZQLNzzoQfjDGURJKqHg/96DhJQ1KSGIJE1wjHjTEOwGhtbe2PmUymwFQqtcH3/R6S6wFYAP4cwROAgueCWYagQXDV/pgx5suGhoZMzPf9jSQ3SlpO8j6AyQiQFgKbBfwhevCUFLJEAIsB1EvaNjY2djYWobAE4KqkYQA2pFqSC9eKUOmCdyPJRfAdyRDIhZgkwzWMpNdIrgWwwlq7KoYK7aVg0aH6+vojAOIA4itXrpwMFnpsW79+PYeHhxNLly61t27dUqFQSAJYAyBhjKmPGWOcc04BCz6AmmKx+IaktcVi8XJLS8ulw4cPz1UX81o6nTZnzpzZIOnlkZGR642NjReLxeJUsC1GUo2JykISp6amlgHYDGCHpHQul3u9u7s7/hjgsXw+v9la+7Fzrstau310dHRFsKWV/TAmYQJ/OgjP8+5IGpO0BEAzgIMTExO7/k0Q3d3d8Vwut9M5956kVgDLADwgWQRgw9r0fd+F2hVJAXBNTU1Fz/N6SV6WVAKwGsC+QqHQnk6nEwuBd3V1LZqYmNgFYD+AJpI+ye9IHmtubr6DiIxJGhM0EEaZOHny5K+JROIDkucllUiuArAvn89vmy+Irq6uRaVSKUVyP4DnADyQdCEWix3q7++/FkwL663SmIBp7c7Q/IkTJ24kk8kekhcA3AewWtKBfD6/Y2BgwKsGT6fTiVKp9KaktwE0SpoieZ7kh9ls9rdI1or6JlRAEMgMyR0/fvyPRCLxEYArABJBVlsHBwefrg4gl8s1StoK4FkABsA3yWSyp7+//+ZcjM22BaZ6kiQvGA/Uo/u1tbXlWdazkvzgHwG4Z629Oxd4MG8m4HTPDKyzs/OFcrmclvRSUAu/AOjv7e0tVi9WV1c3QvIMgNGgS+4ql8sH9uzZs7I60AgDqlbBdAB79+5dUy6XDwJ4FUCS5A2Sn7W2tl6srhcAyGQy5Xg8/hXJLIA7AGpJdvi+fyiVSj0f9htJ00k754xxzplIHyAApFKp5nK5/D6ANklxANeNMT0tLS3n5uuK2Wx2MhaLfQ7gGIARAE9J2mKtTXd2dq4LiY5imaqqdOPj40ustW9JekVSnOQNAJ+uW7fu20dpydlsdrKxsbFP0lEAN0nGAbxord0zPj6+BJWzZZrtfxTd1NTUYpKLJI2T/NkY80ldXd28mVfb0aNH/6qvrx8geQTAVQB/ArClUikRsM1KvoEKwh8lsaamZkLSWZJfGGPe3blz57lMJjNb1c9rmUym3N7e/rWkd0j2AhjcvXv3RIQBAEAMFfkIAI0xplQquba2tiu5XO77TZs2PQCA2RrPo1pHR8e1hoaG3O3bt3Xq1KkZhx8AxAJ5SdJiSVsKhcLyoaEhktTp06cBwITyjN50AIQXk5DBGde16BUMD7eaADYCWCLprjHGxIwxv1trx1C5JrWicgKiqiUgOhb9Vj0vDDL6PXraBoXtkZyUNBbzPO8n59xpANsBLA8yY6iOufz5LJgTgs7wg293SV7yPO8HApVTzPf9ZknPRPcoercMx6y1074xRrPNtdbK8zxaa2WMkXOOxhgFZ40leS+RSIz09fUVFkrmif3n9jcQAx8mizxdVwAAAABJRU5ErkJggg==",PREV_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAACWklEQVRYhe2VP4gTQRTGvzczkgOFCyfEwj+YSosTkRQWJ0YhKS+QxI0WdlqolSBYaKl4hQgKopxYC+5skmZLmwgnNum0THOVsTyOLUxmns0FQjLxstnkRPBX7+z78X1vd4D//GVowe8XnufdBnAVwFet9asDE6jVausA3hhjTggh0O/3QUTFRqPxafg5Ne/BnudliWjTGFOUUkJKyQCglCJmXgOwGIFcLncom80+IaKHzEyDwcMIIcbOzUXA87xrRPTaWnsMAIhobDgAWGvnK1Aqlc6kUql31trLUkoIIZyDB8wtgXw+v5TJZDaI6D4AuOKeltgC1Wr1ppTypbX26KSoJ5GognK5vKqUem+tvUhE+8btYqYKisXi4XQ6/RzAXSKClJKZZ0s8dgKe590iohfMvBw3bhdTJ1CpVM4qpT4YYy4opQAg8fBJOAWUUlvMvJIkbheuCsYyyefzR4wxK6OREy3m2hgTaLVau0KIz8YYwtBlNc8k/igAAFrrK0T0CMAvZl7ole0UAMBBEGz0er2TRPRxNI2Zhzm+gkkCAIBms/nT9/0bANaY+ZsxhijBMky1hC7q9foXrfU5IrrDzDuz1hI7gVGCINjsdrvHAbzdk0heS9wDrVZrV2t9z1q7ysxbcfZj5gpc1Ov171rrSwCuA/hhrd1XJHEFE0T8TqdzCsAzADbufiQWAIB2u90LguBxFEVZIgon1eKSm4vAgDAMt33fX2fmIjN3hmvZ+5PujJ5Z6F+uVqs9APC03+8vKaU4iqLTYRhuL3KmC1Uul88XCoXlgx78b/Abiwj8ZCeQkxsAAAAASUVORK5CYII=",NEXT_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAACW0lEQVRYhe2VMYgTURCGZ957QojCcVqksZEUWggiKRQEY5G0gV0yW9lZnF7hWZ0gNlZaKHaKaGflPkOIWqkgEU5sYqOCTao7wVgeQozJzlhcAudm926TbM7m/m4f8/b/3vzzdgH29Z+FUYtEtAIAZwHgnbX2MQDIngG4rlsSkTfGGGBm0FpvAMCy7/sv5wGgxhaUOmeMAUQUrbUAwNEgCF54nveaiI7tBUB4SbTWIiJlRGxXq9U7hULhwNwAmDmyEBEFtiK7ns/n14moOheAiA5slyilBAByzGyJqFmpVI6nCpBQorUWRDyfyWS+EdH9YrGYSQUgLoI4EAAQEbmWy+U2iOjizAC7RBD9kq1YjjDzUyL66DjOyakBJuzAdo1iOWOM+UxED8rl8sGJAabpQBhkeGOuLC4ufieiSxMBpCVEFERcYOYnnud9cl33RCKAGSIYk4iMPmKnjTFriQDSECKGnyUIgsPFYvFQuNbMA0Dkn58nBkEASqn3zWbzV7h2bjMwBEEA+IOIN6y1F6JqxjqglAqfYBphEASgtX7W7/ev1uv1n3GFYwDMPJZhYldEHAwGoJT6AgBLvu9/2G1Pah0YtnsTEVettY+S7ktjCHEI/LDT6axGDdpEABNEMJruNWZeqtVqXycxjgVIEAEyMyilfgDAirXWn8Y4FmAniQgiIiPi7Xa7favVavVnMY8EGA5TWKNr9arX6y03Go31WY1jAQBgU0RGc4DDmWiLyGXf99+mZRwL0O12n2ez2buDwQCNMb8B4Ka19l7axjuqVCotOI5zKgpwX2nrL1a89wlV6bvAAAAAAElFTkSuQmCC",CLOSE_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAADZ0lEQVRYhe2Wz2skRRTHv6+qMUHn4L9gyMWrXo2SQEDX3YmZth5CzIquC6IHQWX9H3bBBQ8eZFeiiyJd3TMZsz9AlGSNBw8ieNIg6kXJwZsevHS956U79vR0OjNJxMu+S0hR/T6fqnr1poB78T+HbRpcWVl5sNPphP39fTktkHPuofn5+fv39vb+qo6bhomXZ2Zm/pibm/uz1+udOQ04Mw9F5JfZ2dlf6znHBIhoHUBERLNRFN1yzj15ErhzbktEutZaiMh91tqFVgEA2yICAFoI3Ynj+Oxx4ap61hij5Vie58NWgSRJ1o0xOyJCpYS1dss5150GzszDCpyKRT0/GAy+aRUAEJIkWapIgIgAYBjH8cokcOfcpoh0jTEo4US0lqbpx/W51JLHOOd2VHWhXAUA5Hne7ff7Wy3woap2qysnojXv/SeNkBYB8d4vGWO+rh5HFEWfxXH8VNMHzNxvgJ8/DH6UAADkSZIsGmN2azVxu36dmNmLyGpZcCICVb3gvb/RBjhK4ECCiL6q7cStXq93DgCcc5+KyLMlPIRAAC5mWfbBUcnbamBM1jn3haouGmNARFBVAbArIk8UBYcQAowxL3vvr0+SdBqBUmJbVR+vFiaKXRERIqIXvfcbEyecUkC890tEtFPAtYQX/780Dfw4AgAQAPyuqiODRBSI6Ldpk00t4Jz7UETWiKi6cqiqJaLPnXNP/2cCzLwhIuettQBAqkoAfiz+gohARDenadsTCzDzjRDCC9ZaBaAhBAB4NUmSh4lop7j35Q/YxG17olvAzB+FENYLOEIIRESvpWn6XjHFMvO2iIy07RDCuSzLbp5IgJk3ipWjSAoAr2dZ9m5talRIPFbpEwghnMmy7M5h+VuPgJmv1bfdGPNGAxz4t2PuVo/DWnubmQ99WR0qwMzvhxAuVLfdGPOm9/5qi3PuvV80xtyttm0AB227Ho1HUMAvNsDfaYGP5HXOfVm07WpNPJNl2ciLaEyAma+EEN6qwS95769MCC9jrG2rKvI8f3QwGHx3MKnhw1fKe15U+9vHgAPj7wmoKqIoem7Esv6Vqn4vIsjzHMaYS2maXj4GvIxQvCfu5nkOIhIR+bY6YewIlpeXH+h0OgtE9HO/3//pBPCRWF1dfURV/97c3PzhtHLei1OJfwBF5uKlYMgSEgAAAABJRU5ErkJggg==",JUMP_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAADrklEQVRYhe1WQWhcVRQ9970/f/pFg0WTaK2Cg+DGtmtRGBciWUxCk8wPLiriMqgVFFpUWrCiiO6Eim7ETd285I+BoODCMoUubXGjbgomKIiRYJpiNPP+vS7m//HNz7yZXxtXeuHxLu/d+8759917/wP+60L7dVCj0bgtiqJXABxRSvXtiQiJyO/MfGF5efnLf4VAs9l8S0ReK4IXiKDT6RxcWVn5LV/zW9+kEFGViJAPpRSISNwhIgjD8JjrF+wXgZ2dnXeiKDosIkeJiEXkLiK6R0TEIQlmvnMogUajcXcYhg9rrYddz6Yx5lt3YXV19VcATwPA9PT0ZBRFVx3sniilKl4Cc3Nzx4MgSNI0JWYegg/EcfyBMeb54vrs7OxEEARXANwLQNDNsx4TEenD7MsBrfVZAKS1lhEDAJr1ev2A61+v12+vVCqXARxywK/DSfahBAAcdHRi5oEjTVMA+Krdbv+RG09NTVUnJycvi8hDRJSDb1prj7vRJCL/FRBRbkkArjLzuSAItGsjIkREm8aYi+6HjI2NXcwSMAe/Ya19bG1tbb1WqzEAlRG55iUAoEdVRH5OkuQzlJA4jr9g5keVUkLdeut0Op16q9X6HgBqtdpJEXlZa/21MeZSKQJEVKpJLSwsJMz8lFJKAJCIsLX2yVardSW3McacB3B+kH8xB9xsHUkgjuOP0zSddcBhrZ1OkuTSKN9cvI1oVATiOH6fmZ/TWgsAZPd7IkmSzwFgfn7+CaXUmyLyw8bGxmK73b4x6JxhEfC26WazeY6ZX8zB0zQlIlpcWlq60DtYqU8APC4iJyYmJl7wneUFIaKBe3EcLzLzGRdcKfW6MebDgv+h/J8A4MGyBMrkwKtB0L25DPxdY8zbA+ysQ6ZaioDbu30RAPAdM8NaS0qpj4wxpz121tEPeGz2NKKREbDWPhMEwbNa65+MMZ/6DhYRq5TKPyosRaBAZiCBVqv1C4D3fH6O7OYRLfZ/V7w5gFt8LRHRTjYDgPbZeatgWBmWlD8d3XsFxSR0Xy+3+l50kzAqRWCfpePo3jL0VgGAB+I4fgNAhYiUiKjsT1ecqevap7OIHHaqoO8N4CXgiAC4D8BZ4O/+4JsH6Rm4ZIS8VdC3ISI/AjiSXb/cRBrsMcwIETODiK7tdRlAwFp7KgiCR9I0vR/olVA/krPm6FIYnOtE9M3u7u5LpZkDwMzMzB0AsLW11W1jYSjb29tcrVYliiJZX1+X8fFxbrfbLuD/8o/kL6/r0h5ZDjXcAAAAAElFTkSuQmCC",CHANNEL="./../img/channel.jpg",Util=function(){function n(){}return n.getLS=function(e,t,a){var i=window.localStorage.getItem(e);null!==i?t(i):a&&a()},n.getLSInt=function(e,t,a){var i=n.int(window.localStorage.getItem(e));isNaN(i)?a&&a():t(i)},n.isNull=function(e){return"undefined"===$.type(e)||null===e},n.escapeHtmlSpecialChars=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},n.saveAsFile=function(e,t){var a=new Blob([t],{type:"text/plane;"});if(n.isNull(window.navigator.msSaveOrOpenBlob)){var i=document.createElement("a"),r=URL.createObjectURL(a);i.href=r,i.download=e,document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(r)},0)}else window.navigator.msSaveOrOpenBlob(a,e)},n.bytesize=function(e){return encodeURIComponent(e).replace(/%../g,"a").length},n.int=function(e){if(null===e)return NaN;var t=parseInt(e,10);if(isNaN(t)){var a=e.match(/\d+/);return null==a?NaN:parseInt(a[0],10)}return t},n.cutStringBytesize=function(e,t){if(t=t||50,!(n.bytesize(e)>t))return e;for(var a=0,i="",r=0;r<e.length;r++){var l=e.charAt(r);if(t<(a+=n.bytesize(l)))return i+"...";i+=l}},n.cutString=function(e,t){return t=t||40,e.length>t?e.substring(0,t)+"...":e},n.registerTooltip=function(e){e.tooltip({placement:"bottom",animation:!1,template:'<div class="tooltip mt-2" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'})},n.copyObj=function(e){return $.extend(!0,{},e)},n.shuffle=function(e,t){var a=e.slice(0);if(a.length<=1)return a;if(t){var i=$.inArray(t,a);-1!==i&&a.splice(i,1)}for(var r,l,n=a.length;n;)l=Math.floor(Math.random()*n--),r=a[n],a[n]=a[l],a[l]=r;return t&&-1!==i&&a.splice(0,0,t),a},n.domain="https://tkgwku.github.io/n",n}(),NicolistPlayer=function(){function l(){}return l.registerEventListener=function(){$(window).resize(function(){0!==$("#play iframe").length&&l.videoResize()}),$(window).on("unload",function(){}),$(window).scroll(function(){}),$("#pcclose").on("click",function(){$("#play").html(""),$("#pclist").addClass("silent").html(""),$("#controller").addClass("silent"),l.playindex=-1,l.playlist=[]}),$("#pcnewtab").on("click",function(){window.open(Util.domain+"/player.html?pl="+escape(JSON.stringify(l.playlist))+"&i="+l.playindex)}),$("#pclist").on("change",function(){l.playindex=Util.int($("#pclist").val()+""),isNaN(l.playindex)&&(l.playindex=0),l.autoplay=!1,l.refreshPlayer()}),$("#pcnext").on("click",function(e){$(e.currentTarget).hasClass("disabled")||(l.autoplay=!0,l.next())}),$("#pcprev").on("click",function(e){$(e.currentTarget).hasClass("disabled")||(l.autoplay=!0,l.previous())}),$("#pcloop").on("click",function(){$("#nicolist_loop").prop("checked")?($("#nicolist_loop").prop("checked",!1),localStorage.setItem("nicolist_loop","false"),$("#pcloop img").attr("src",NOT_LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生")):($("#nicolist_loop").prop("checked",!0),localStorage.setItem("nicolist_loop","true"),$("#pcloop img").attr("src",LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生を解除")),$("#pcloop").tooltip("dispose"),Util.registerTooltip($("#pcloop")),$("#pcloop").tooltip("show"),l.refreshController()}),$("#pcwidth").on("click",function(){$("#nicolist_cinematic").prop("checked")?($("#nicolist_cinematic").prop("checked",!1),localStorage.setItem("nicolist_cinematic","false"),$("#pcwidth img").attr("src",WIDEN_DATA_URL),$("#pcwidth").attr("title","ワイド画面で表示")):($("#nicolist_cinematic").prop("checked",!0),localStorage.setItem("nicolist_cinematic","true"),$("#pcwidth img").attr("src",NARROW_DATA_URL),$("#pcwidth").attr("title","固定サイズで表示")),$("#pcwidth").tooltip("dispose"),Util.registerTooltip($("#pcwidth")),$("#pcwidth").tooltip("show"),l.videoResize()})},l.setupYoutubeIframe=function(t){$("#play").html("");var e=$("<div>",{id:"playeriframeyoutube"});$("#play").append(e),l.player=new YT.Player("playeriframeyoutube",{videoId:t,playerVars:{autoplay:l.autoplay?1:0},events:{onStateChange:function(e){e.data===YT.PlayerState.ENDED?(l.autoplay=!0,l.next()):e.data===YT.PlayerState.CUED&&(l.removeFromDeletedVideoList(t),l.autoplay&&(l.player.playVideo(),l.autoplay=!1))},onError:function(e){l.addToDeletedVideoList(t),l.autoplay=!0,l.next()}}}),l.videoResize()},l.setupNiconicoIframe=function(i){$("#play").html("");var e=$("<iframe>",{id:"playeriframenicovideo",src:"https://embed.nicovideo.jp/watch/"+i+"?jsapi=1&playerId=0",frameborder:"0",allow:"autoplay; encrypted-media",allowfullscreen:""});$("#play").append(e),l.videoResize(),window.onmessage=function(e){if("https://embed.nicovideo.jp"===e.origin)if("error"===e.data.eventName)l.addToDeletedVideoList(i),l.autoplay=!0,l.next();else if("playerStatusChange"===e.data.eventName)4===e.data.data.playerStatus&&(l.autoplay=!0,l.next());else if("loadComplete"===e.data.eventName){if(l.autoplay&&($("#play iframe").get(0).contentWindow.postMessage({eventName:"play",playerId:"0",sourceConnectorType:1},"https://embed.nicovideo.jp"),l.autoplay=!1),l.removeFromDeletedVideoList(i),$("#nicolist_savevolume").prop("checked")){var t=l.playlist[l.playindex];l.volumemap.hasOwnProperty(t)&&$("#play iframe").get(0).contentWindow.postMessage({eventName:"volumeChange",playerId:"0",sourceConnectorType:1,data:{volume:l.volumemap[t]}},"https://embed.nicovideo.jp"),l.skip_flag=!0}}else if($("#nicolist_savevolume").prop("checked")&&"playerMetadataChange"===e.data.eventName)if(l.skip_flag)l.skip_flag=!1;else{var a=Math.round(1e3*e.data.data.volume)/1e3;t=l.playlist[l.playindex];l.volumemap.hasOwnProperty(t)&&l.volumemap[t]===a||(l.volumemap[t]=a,localStorage.setItem("nicolist_volumemap",JSON.stringify(l.volumemap)))}}},l.addToDeletedVideoList=function(e){if(-1===$.inArray(e,l.deletedVideoArray)){l.deletedVideoArray.push(e),localStorage.setItem("nicolist_deleted",JSON.stringify(l.deletedVideoArray));var t=$("#pclist option[value="+l.playindex+"]");0!==t.length&&t.text("[x] "+(l.playindex+1)+": "+l.playlistTitleMap[e])}},l.removeFromDeletedVideoList=function(e){var t=$.inArray(e,l.deletedVideoArray);if(-1!==t){l.deletedVideoArray.splice(t,1),localStorage.setItem("nicolist_deleted",JSON.stringify(l.deletedVideoArray));var a=$("#pclist option[value="+l.playindex+"]");0!==a.length&&a.text(l.playindex+1+": "+l.playlistTitleMap[e])}},l.videoSize=function(){var e=$("#play").outerWidth(),t=Math.ceil(9*e/16);return.7*$(window).height()<t&&(t=Math.ceil(.7*$(window).height()),e=Math.ceil(16*t/9)),e<640||$("#nicolist_cinematic").prop("checked")?[e,t]:[640,360]},l.videoResize=function(){var e=l.videoSize();$("#play iframe").css({width:e[0],height:e[1]}),$("#controller").css({width:e[0]})},l.next=function(){l.hasNext()?(l.playindex++,l.refreshPlayer()):$("#nicolist_loop").prop("checked")&&(l.playindex=0,l.refreshPlayer())},l.hasNext=function(){return-1<l.playindex&&l.playlist.length>l.playindex+1},l.hasPrevious=function(){return 0<l.playindex},l.previous=function(){l.hasPrevious()?(l.playindex--,l.refreshPlayer()):$("#nicolist_loop").prop("checked")&&(l.playindex=l.playlist.length-1,l.refreshPlayer())},l.refreshPlayer=function(){var e=l.playlist[l.playindex];/^sm\d+$/.test(e)||/^nm\d+$/.test(e)||/^so\d+$/.test(e)||/^\d+$/.test(e)?0===$("#play iframe").length||"playeriframeyoutube"===$("#play iframe").attr("id")?l.setupNiconicoIframe(e):$("#play iframe").attr("src","https://embed.nicovideo.jp/watch/"+e+"?jsapi=1&playerId=0"):0===$("#play iframe").length||"playeriframenicovideo"===$("#play iframe").attr("id")?l.setupYoutubeIframe(e):l.player.loadVideoById({videoId:e}),l.refreshController()},l.refreshController=function(){l.hasNext()||$("#nicolist_loop").prop("checked")?$("#pcnext").removeClass("disabled"):$("#pcnext").addClass("disabled"),l.hasPrevious()||$("#nicolist_loop").prop("checked")?$("#pcprev").removeClass("disabled"):$("#pcprev").addClass("disabled"),""!==$("#play").html()?$("#controller").removeClass("silent"):$("#controller").addClass("silent"),1<l.playlist.length?($("#pclist").removeClass("silent"),$("#pclist").val(l.playindex+"")):$("#pclist").addClass("silent"),$("#pcfav").html(""),l.showFavbutton&&($("#pcfav").append(Nicolist.createFavIcon(l.playlist[l.playindex],l.playlistTitleMap[l.playlist[l.playindex]]).removeClass("mr-2")),Util.registerTooltip($("#pcfav .favIcon")))},l.initPlaylistSel=function(){var e,t;for($("#pclist").html(""),t=0;t<l.playlist.length;t++)l.playlistTitleMap.hasOwnProperty(l.playlist[t])&&(e=-1===$.inArray(l.playlist[t],l.deletedVideoArray)?"":"[x] ",$("<option>",{text:e+(t+1)+": "+l.playlistTitleMap[l.playlist[t]],value:t+""}).appendTo($("#pclist")))},l.createEmbedElem=function(){var e=l.playlist[l.playindex];/^sm\d+$/.test(e)||/^nm\d+$/.test(e)||/^so\d+$/.test(e)||/^\d+$/.test(e)?l.setupNiconicoIframe(e):l.setupYoutubeIframe(e);try{$("#play iframe").get(0).contentWindow.ondrop=function(e){e.preventDefault(),e.stopPropagation()}}catch(e){}l.initPlaylistSel(),$("#pcprev img").attr("src",PREV_DATA_URL),$("#pcnext img").attr("src",NEXT_DATA_URL),$("#pcclose img").attr("src",CLOSE_DATA_URL),$("#pcnewtab img").attr("src",JUMP_DATA_URL),$("#nicolist_loop").prop("checked")?($("#pcloop img").attr("src",LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生を解除")):($("#pcloop img").attr("src",NOT_LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生")),Util.registerTooltip($("#pcloop")),$("#nicolist_cinematic").prop("checked")?($("#pcwidth img").attr("src",NARROW_DATA_URL),$("#pcwidth").attr("title","固定サイズで表示")):($("#pcwidth img").attr("src",WIDEN_DATA_URL),$("#pcwidth").attr("title","ワイド画面で表示")),Util.registerTooltip($("#pcwidth"))},l.init=function(){l.registerEventListener(),$("input[type=checkbox]").on("change",function(e){var t=$(e.currentTarget).attr("id");Util.isNull(t)||window.localStorage.setItem(t,$(e.currentTarget).prop("checked"))}),$("#pcrestore").on("click",function(){l.restore()}),$("#pcopenpref").on("click",function(){$("#prefModal").modal("show")}),l.fromURLInfo()},l.fromURLInfo=function(){var e=window.location.search.match(/[^?&]+=[^?&]*/g);if(null!==e){for(var t=0;t<e.length;t++){var a=e[t].match(/^pl=([^?&]+)$/);if(a)try{l.playlist=JSON.parse(unescape(a[1]))}catch(e){return void $("#play").text(e)}else{var i=e[t].match(/^i=(\d+)$/);i&&(l.playindex=Util.int(i[1]))}}l.playlist instanceof Array&&0!==l.playlist.length?((l.playlist.length<=l.playindex||l.playindex<0)&&(l.playindex=0),l.refreshController(),l.createEmbedElem(),localStorage.setItem("nicolist_playlist_s","pl="+JSON.stringify(l.playlist)+"&i="+l.playindex)):$("#play").text("プレイリスト情報が不正です。")}else{localStorage.getItem("nicolist_playlist_next")&&l.restore(),$("#noquery").removeClass("silent");var r=localStorage.getItem("nicolist_playlist_s");r&&r.match(/[^?&]+=[^?&]*/g)&&$("#restoreQuestion").removeClass("silent")}},l.restore=function(){var e=localStorage.getItem("nicolist_playlist_s");if(e){var t=e.match(/^pl=([^?&]+)&i=(\d+)$/);t&&2<t.length&&(l.playlist=JSON.parse(unescape(t[1])),l.playindex=parseInt(t[2],10),l.refreshController(),l.createEmbedElem(),$("#noquery").addClass("silent"))}},l.showFavbutton=!1,l.playlist=[],l.playlistTitleMap={},l.playindex=-1,l.deletedVideoArray=[],l.volumemap={},l.autoplay=!1,l.skip_flag=!1,l}(),Nicolist=function(){function B(){}return B.loadImg=function(e){var t=e.attr("data-src");t&&(e.on("load",function(e){-1===$.inArray($(e.currentTarget).attr("src"),B.loadedtn)&&B.loadedtn.push($(e.currentTarget).attr("src")),$(e.currentTarget).removeClass("loading")}),e.attr("src",t))},B.escapeREInsideBracket=function(e){return e.replace(/[\[\]\-\\\*\^]/g,function(e){return"\\"+e})},B.loadImgOnScreen=function(e,t){var a=$(window).height()+$(e).scrollTop();$(t).find("img[data-src]:visible").each(function(e,t){$(t).offset().top<a&&B.loadImg($(t))})},B.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,function(e){return"\\"+e})},B.search=function(e){var t=B.escapeREInsideBracket($("#nicolist_separator").val()),a=[];if(""===t)a=[e];else{var i=t.charAt(0);a=e.replace(new RegExp("["+t+"]","g"),i).replace(new RegExp(i+"+","g"),i).replace(new RegExp(i+"$|^"+i,"g"),"").split(i)}if(""!==a[0]){var r=a.join("」+「");$("#sr").html(""),$("<button>",{html:"<span>&times;</span>",class:"close","aria-label":"Close",click:function(e){$("#sr").fadeOut("slow",function(){B.refreshStyle(),$("#sr").html("")})}}).appendTo("#sr"),B.pushHistory(e);var l=0,n={},o=$("#nicolist_and").prop("checked"),s=Util.int($("#nicolist_msc").val());s<=0&&(s=1/0);var c=B.escapeREInsideBracket($("#nicolist_ignore").val());for(var d in B.y){var p=B.y[d];$("#nicolist_sort").prop("checked")&&(p=B.reversePairList(p));for(var g=0,u=p.length/2;g<u;g++){var A=p[2*g],h=p[2*g+1],f=!0;if(o){f=!0;for(var m=0,y=a;m<y.length;m++){var v=y[m];if(!(""!==c?h.replace(new RegExp("["+c+"]","g"),"").match(new RegExp(B.escapeRegExp(v),"gi")):h.match(new RegExp(B.escapeRegExp(v),"gi")))){f=!1;break}}}else{f=!1;for(var w=0,T=a;w<T.length;w++){v=T[w];if(""!==c?h.replace(new RegExp("["+c+"]","g"),"").match(new RegExp(B.escapeRegExp(v),"gi")):h.match(new RegExp(B.escapeRegExp(v),"gi"))){f=!0;break}}}if(f){if(s<++l)return $("#sr").append($("<span>",{text:"検索条件「"+r+"」に一致する動画が多すぎます"})),void $("#sr").fadeIn();n.hasOwnProperty(d)||(n[d]=[]),n[d].push(A),n[d].push(h)}}}var b=Object.keys(n),C=b.length;if(0===C)return $("#sr").append($("<span>",{text:"検索条件「"+r+"」に一致する動画はありませんでした"})),void $("#sr").fadeIn();var E=$("<div>");$("<h4>",{text:"「"+r+"」の検索結果"}).append($("<small>",{text:"("+l+"件の一致)",class:"text-muted ml-2"})).appendTo(E);for(var S=2<C&&20<l,I=0;I<C;I++){p=n[d=b[I]];var k=$("<div>"),x=$("<span>",{text:(S?"- ":"")+d,"data-genre":d,"data-for":"genreTitle"});S&&(x.on("click",function(e){var t=$(e.currentTarget).attr("data-genre");$('#sr div[data-for=wrapperGenre][data-genre!="'+t+'"]').each(function(e,t){$(t).addClass("silent")}),$('#sr div[data-for=wrapperGenre][data-genre="'+t+'"]').each(function(e,t){$(t).toggleClass("silent"),B.loadImgOnScreen("html, body","#sr")})}),x.addClass("pointer hover")),k.append(x),E.append(k);var N=$("<div>",{"data-genre":d,"data-for":"wrapperGenre",class:"mt-2 mb-2"});S&&N.addClass("silent");for(var R=0,U=p.length/2;R<U;R++){A=p[2*R],h=p[2*R+1];var P=$("<div>",{class:"d-flex align-items-center flex-row"}),M=B.createFavIcon(A,h);P.append(M);var O=$("<a>",{href:B.getVideoURL(A),target:"_blank","data-genre":d,"data-id":A,"data-title":h,contextmenu:function(e){return B.showMenu(e.pageX,e.pageY,$(e.currentTarget),"search"),!1},click:function(e){"official"!==$("#click_action").val()&&e.preventDefault(),B.openVideo($(e.currentTarget),"search")}});$("#nicolist_thumb_res").prop("checked")&&O.append(B.createStayUnloadedTNI(A,!1));var V=void 0;if($("#nicolist_highlight").prop("checked")){h=Util.escapeHtmlSpecialChars(h);for(var L=0,G=a;L<G.length;L++){v=G[L];h=h.replace(new RegExp(B.compoundRe(B.escapeRegExp(v),"["+c+"]*"),"gi"),function(e){return"<mark>"+e+"</mark>"})}V=$("<span>",{html:h})}else V=$("<span>",{text:h});O.append(V),O.appendTo(P),P.appendTo(N)}N.appendTo(E)}$("#sr").append(E),$("#sr").fadeIn(),B.loadImgOnScreen("html, body","#sr"),$("#alert").fadeOut()}else B.message("検索クエリが空です。")},B.compoundRe=function(e,t){for(var a="",i=0,r=e.length;i<r;i++)a+=e.charAt(i),i<r-1&&(a+=t);return a},B.getVideoURL=function(e){return/^sm\d+$/.test(e)||/^nm\d+$/.test(e)||/^so\d+$/.test(e)||/^\d+$/.test(e)?"http://www.nicovideo.jp/watch/"+e:"https://www.youtube.com/watch?v="+e},B.getThumbURL=function(e){if(/^sm\d+$/.test(e))return"http://tn.smilevideo.jp/smile?i="+Util.int(e);if(/^nm\d+$/.test(e))return"http://tn.smilevideo.jp/smile?i="+Util.int(e);if(/^so\d+$/.test(e))return"http://tn.smilevideo.jp/smile?i="+Util.int(e);if(/^\d+$/.test(e)){Util.int(e);return CHANNEL}return"https://img.youtube.com/vi/"+e+"/0.jpg"},B.videoIdMatch=function(e){var t=e.match(/nicovideo\.jp\/watch\/(sm\d+)/);if(null!==t)return t[1];var a=e.match(/nicovideo\.jp\/watch\/(nm\d+)/);if(null!==a)return a[1];var i=e.match(/nicovideo\.jp\/watch\/(so\d+)/);if(null!==i)return i[1];var r=e.match(/nicovideo\.jp\/watch\/(\d+)/);if(null!==r)return r[1];var l=e.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/);if(null!==l)return l[1];var n=e.match(/youtube\.com\/watch\?[^&]+&v=([a-zA-Z0-9_-]+)/);return null!==n?n[1]:null},B.sub=function(){if(B.checkValidity()){var e=$("#title").val()+"",t=$("#genre").val()+"",a=B.videoIdMatch($("#url").val());B.has(t,a)?B.message("すでに登録されています","warning","#alert-addvideo"):(B.pushPrev(),B.y[t].push(a),B.y[t].push(e),B.refresh("v"),$("#url").val(""),$("#title").val(""),$("#url, #title").removeClass("is-valid"),$("#registry").hasClass("silent")||$("#registry").addClass("silent"),$("#registry").html(""),B.lastId="",$("#alert, #alert-addvideo").fadeOut(),$("#nicolist_stayopen").prop("checked")?B.messageUndoable("動画「"+Util.cutString(e,50)+"」を追加しました","success","#alert-addvideo","v"):(B.messageUndoable("動画「"+Util.cutString(e,50)+"」を追加しました","success",null,"v"),$("#addVideoModal").modal("hide")))}},B.checkTitleValidity=function(e){return""===e.val()||100<e.val().length||/^http:\/\//.test(e.val())||/^https:\/\//.test(e.val())?(e.removeClass("is-valid"),e.addClass("is-invalid"),!1):(e.removeClass("is-invalid"),e.addClass("is-valid"),!0)},B.checkURLValidity=function(){var e=B.videoIdMatch($("#url").val()+"");if(null===e)return $("#url").removeClass("is-valid"),$("#url").addClass("is-invalid"),$("#registry").addClass("silent"),!1;if($("#url").removeClass("is-invalid"),$("#url").addClass("is-valid"),e!==B.lastId){$("#registry").html("");var t=$("<ul>",{class:"list-unstyled"});for(var a in B.y)for(var i=B.y[a],r=0,l=i.length/2;r<l;r++){var n=i[2*r],o=i[2*r+1];n===e&&t.append($("<li>",{text:a}).append($("<span>",{text:"("+Util.cutString(o,80)+")",class:"ml-2 text-muted"})))}var s=$("<div>",{class:"d-flex align-items-center flex-row"});s.append(B.createThumbImgElem(e,!1)),""!==t.html()?($("#registry").prepend($("<div>",{text:"この動画はすでに以下のジャンルに登録されています:",class:"mb-2 text-muted"})),s.append(t)):s.append($("<span>",{text:"サムネイルはこのように表示されます",class:"text-muted"})),s.appendTo("#registry"),$("#registry").removeClass("silent"),B.lastId=e}return!0},B.checkGenreValidity=function(){return""!==$("#genre").val()||($("#genre").addClass("is-invalid"),!1)},B.checkValidity=function(){var e=B.checkGenreValidity();return e=B.checkURLValidity()&&e,(e=B.checkTitleValidity($("#title"))&&e)?$("#button").prop("disabled",!1):$("#button").prop("disabled",!0),e},B.pushHistory=function(e){var t=$.inArray(e,B.searchHistory);if(-1===t){(r=[]).push(e);for(var a=Math.min(Util.int($("#nicolist_historyCount").val()+"")-1,B.searchHistory.length),i=0;i<a;i++)r.push(B.searchHistory[i]);B.searchHistory=r}else{var r;(r=[]).push(e);i=0;for(var l=B.searchHistory.length;i<l;i++)i!==t&&r.push(B.searchHistory[i]);B.searchHistory=r}localStorage.setItem("searchHistory",JSON.stringify(B.searchHistory))},B.handleVideoDrop=function(e){for(var t=e.pageX>$("#addVideoModal").outerWidth(!0)/2?"#title":"#url",a=e.dataTransfer.items||e.originalEvent.dataTransfer.items,i=0;i<a.length;i++)"string"===a[i].kind&&(/^text\/plain/.test(a[i].type)?a[i].getAsString(function(e){$(t).val(e),B.checkValidity()}):/^text\/html/.test(a[i].type)?a[i].getAsString(function(e){var t=e.match(/<[^><]+>[^><]*(?=<)/g),a=null;if(null!==t)for(var i=0,r=t.length;i<r;i++)/<span id="video-title"/.test(t[i])&&(a=t[i].replace(/<[^><]+>/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/\n/g,""),$("#title").val(a));if(null===a){var l=e.replace(/<[^><]+>/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/\n/g,"");$("#title").val(l)}B.checkValidity()}):/^text\/uri-list/.test(a[i].type)&&a[i].getAsString(function(e){$("#url").val(e),B.checkValidity()}));$(t).removeClass("dragging")},B.registerEventListener=function(){$(window).on("unload",function(){B.unload()}),$(window).scroll(function(){B.loadImgOnScreen("html, body","#sr, #right")}),$("#ccModal").scroll(function(){B.loadImgOnScreen("#ccModal","#ccvideos")}),NicolistPlayer.registerEventListener(),$("input[type=checkbox]").on("change",function(e){var t=$(e.currentTarget).attr("id");Util.isNull(t)||window.localStorage.setItem(t,$(e.currentTarget).prop("checked"))}),$("#nicolist_thumb_cc").on("change",function(){$("#ccvideos").find(".img-thumbnail").each(function(e,t){$(t).toggleClass("silent"),B.loadImgOnScreen("#ccModal","#ccvideos")})}),$("#ccopen").on("click",function(e){for(var t in $("#ccvideos").html(""),$("#ccalert").html(""),$("#ccModal").modal("show"),B.y){var a=$("<p>",{click:function(e){var a=$(e.currentTarget),t=a.next();return t.hasClass("silent")?(t.removeClass("silent"),a.parent().find(".ccgenrename").each(function(e,t){$(t).attr("data-genre")!==a.attr("data-genre")&&($(t).next().addClass("silent"),$(t).find(".cc_genre_indicator").text("-"))}),a.find(".cc_genre_indicator").text("+"),B.loadImgOnScreen("#ccModal","#ccvideos")):(t.addClass("silent"),a.find(".cc_genre_indicator").text("-")),!1},"data-genre":t,class:"ccgenrename"});a.append($("<span>",{text:"-",class:"cc_genre_indicator mr-1"})),a.append($("<span>",{text:t})),a.append($("<span>",{"data-count":"0",class:"badge badge-pill badge-secondary2 ml-2"}));var i=$("<div>",{class:"silent"}),r=B.y[t];$("#nicolist_sort").prop("checked")&&(r=B.reversePairList(r));for(var l=0,n=r.length/2;l<n;l++){var o=r[2*l],s=r[2*l+1],c=$("<div>",{class:"d-flex flex-row align-items-center ccvideo","data-title":s,"data-id":o,"data-genre":t,"data-for":"cc_genre_video",click:function(e){var t=$(e.currentTarget),a=t.parent().prev().find("[data-count]"),i=Util.int(a.attr("data-count"));t.hasClass("alert-success")?(t.removeClass("alert-success"),i--):(t.addClass("alert-success"),i++),a.attr("data-count",i+""),0===i?a.addClass("silent"):(a.removeClass("silent"),a.text(i+""))}}),d=B.createStayUnloadedTNI(o,!1);$("#nicolist_thumb_cc").prop("checked")||d.addClass("silent"),c.append(d),c.append($("<span>",{text:s})),i.append(c)}$("#ccvideos").append(a),$("#ccvideos").append(i)}B.loadImgOnScreen("#ccModal","#ccvideos")}),$("#ccnew").on("change",function(e){var t=$("#ccnew").val()+"";localStorage.setItem("nicolist_ccnewval",t+""),"copytoold"===t||"movetoold"===t?($("#ccnewform").css("display","none"),$("#ccoldform").css("display","block")):($("#ccnewform").css("display","block"),$("#ccoldform").css("display","none")),"copytoold"===t||"copytoold"===t?$("#createcopy, #createcopy2").text("コピー"):$("#createcopy, #createcopy2").text("移動")}),$("#createcopy, #createcopy2").on("click",function(){var e=$("#ccvideos").find(".alert-success[data-for=cc_genre_video]");if(0===e.length)return B.message("動画が選択されていません。","warning","#ccalert"),void $("#ccModal").stop().animate({scrollTop:0},"slow");var t=$("#ccnew").val()+"";if("copytoold"===t||"movetoold"===t){var c=$("#ccoldsel").val()+"";if(!B.y.hasOwnProperty(c))return void B.message("ジャンルを選択してください。","warning","#ccalert");var d="movetoold"===t,p=0,g=0,u=Util.copyObj(B.y);if(e.each(function(e,t){var a=$(t).attr("data-id"),i=$(t).attr("data-title");if(-1===$.inArray(a,u[c])){if(u[c].push(a),u[c].push(i),d){for(var r=$(t).attr("data-genre"),l=u[r],n=[],o=0,s=l.length/2;o<s;o++)l[2*o]!==a&&(n.push(l[2*o]),n.push(l[2*o+1]));u[r]=n}g++}else p++}),!(0<g))return B.message("すべて「"+c+"」に登録済みの動画です","warning","#ccalert"),void $("#ccModal").stop().animate({scrollTop:0},"slow");B.pushPrev(),B.y=u,B.messageUndoable(g+"個の動画を「"+c+"」に"+(i=d?"移動":"コピー")+"しました"+(0<p?" ("+p+"個の動画は既に登録されているため"+i+"されません)":""),"success",null,"vgs"),B.setSelGen(c),B.refresh("gvs"),$("#ccModal").modal("hide")}else if("copytonew"===t||"movetonew"===t){var A="movetonew"===t,a=$("#ccname").val()+"";if(""===a)return B.message("作成するジャンルの名前を入力してください。","warning","#ccalert"),void $("#ccModal").stop().animate({scrollTop:0},"slow");if(B.y.hasOwnProperty(a))return B.message("既に存在するジャンル名です。","warning","#ccalert"),void $("#ccModal").stop().animate({scrollTop:0},"slow");B.pushPrev();var h=[];e.each(function(e,t){var a=$(t).attr("data-title"),i=$(t).attr("data-id");if(A){for(var r=$(t).attr("data-genre"),l=B.y[r],n=[],o=0,s=l.length/2;o<s;o++)l[2*o]!==i&&(n.push(l[2*o]),n.push(l[2*o+1]));B.y[r]=n}-1===$.inArray(i,h)&&(h.push(i),h.push(a))}),B.y[a]=h;var i=A?"移動":"コピー";B.messageUndoable("「"+a+"」に"+h.length/2+"個の動画を"+i+"しました","success",null,"gvs"),B.setSelGen(a),B.refresh("gvs"),$("#ccalert").fadeOut(),$("#ccModal").modal("hide"),$("#ccname").val("")}}),$("#showAddGenre").on("click",function(){$("#genreModal").modal("show"),$("#alert-genre").html("")}),$("#randomFromAll").on("click",function(){B.randomFromAll()}),$("#randomFromRight").on("click",function(){B.randomFromRight()}),$("#favs").on("click",function(e){$(e.currentTarget).hasClass("disabled")||B.showFavs()}),$("#nicolist_thumb").on("change",function(){B.refresh("v")}),$("#nicolist_taggedtitle").on("change",function(){B.refresh("v")}),$("#nicolist_sort").on("change",function(){B.refresh("v")}),$("#nicolist_multitab").on("change",function(){$("#laert").fadeOut()}),$("#openAddModal").on("click",function(){$("#alert-addvideo").html(""),$("#addVideoModal").modal("show")}),$("#click_action").on("change",function(e){localStorage.setItem("nicolist_click_action",$(e.currentTarget).val()+"")}),$("#openPref").on("click",function(){$("#nicolist_separator").removeClass("is-valid"),$("#prefModal").modal("show")}),$("#nicolist_separator").on("input",function(){localStorage.setItem("nicolist_separator",$("#nicolist_separator").val()+""),$("#nicolist_separator").addClass("is-valid")}),$("#nicolist_ignore").on("input",function(){localStorage.setItem("nicolist_ignore",$("#nicolist_ignore").val()+"")}),$("#body").on("dragstart",function(e){e.originalEvent.dataTransfer.clearData()}),$("#body, #prefModal").on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),$("#body").on("drop",function(e){e.preventDefault();for(var t=e.originalEvent.dataTransfer.items||e.originalEvent.dataTransfer.files,a=0;a<t.length;a++){var i="file"===t[a].kind&&/json/.test(t[a].type);if(i&&(B.fileToLoad=t[a].getAsFile()),Util.isNull(t[a].kind)&&(i=/\.json$/.test(t[a].name))&&(B.fileToLoad=t[a]),i){$("#rawFileName").text(B.fileToLoad.name),$("#loadRawJson").removeClass("silent"),$("#dummyLoadRawJson").addClass("silent");var r=function(){$("#prefModal").stop().animate({scrollTop:$("#loadRawJson").offset().top},1400,function(){$("#prefModal").off("shown.bs.modal",r)})};$("#prefModal").on("shown.bs.modal",r),$("#prefModal").modal("show");break}if("string"===t[a].kind){$("#addVideoModal").modal("show"),B.handleVideoDrop(e);break}}}),$("#prefModal").on("drop",function(e){e.preventDefault();for(var t=e.originalEvent.dataTransfer.items||e.originalEvent.dataTransfer.files,a=0;a<t.length;a++){var i="file"===t[a].kind&&/json/.test(t[a].type);i&&(B.fileToLoad=t[a].getAsFile()),Util.isNull(t[a].kind)&&(i=/\.json$/.test(t[a].name))&&(B.fileToLoad=t[a]),i&&(B.fileToLoad=t[a].getAsFile(),$("#rawFileName").text(B.fileToLoad.name),$("#loadRawJson").removeClass("silent"),$("#dummyLoadRawJson").addClass("silent"))}}),$("#addVideoModal").on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.pageX>$("body").outerWidth(!0)/2?($("#title").addClass("dragging"),$("#url").removeClass("dragging")):($("#url").addClass("dragging"),$("#title").removeClass("dragging"))}),$("#addVideoModal").on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),$("#url, #title").removeClass("dragging")}),$("#addVideoModal").on("drop",function(e){e.preventDefault(),B.handleVideoDrop(e)}),$("#url, #title").on("input",function(e){B.checkValidity()}),$("body").on("click",function(e){B.showingMenu&&B.closeMenu(),$("#history").css("display","none")}),$("#menu").on("click",function(e){e.stopPropagation()}),$("#addgenre").on("click",function(e){e.stopPropagation(),B.addGenre($("#genrename").val())?(B.setSelGen($("#genrename").val()),$("#genreModal").modal("hide"),$("#genrename").val(""),B.refresh("gs")):($("#genrename").blur(),$("#genrename").focus())}),$("#genrename").on("keypress",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),B.addGenre($("#genrename").val())?(B.setSelGen($("#genrename").val()),$("#genreModal").modal("hide"),$("#genrename").val(""),B.refresh("gs")):($("#genrename").blur(),$("#genrename").focus()))}),$("#button").on("click",function(e){B.sub()}),$("#genreModal").on("shown.bs.modal",function(){$("#genrename").focus()}),$("#saveEdit").on("click",function(e){var r=$("#editUrl").text(),l=$("#editTitle").val()+"",n=$("#editGenre").val()+"",t=$(e.currentTarget).attr("data-title"),o=$(e.currentTarget).attr("data-genre");if(""===l)B.message("タイトルが空欄です","warning","#emalert"),$("#editTitle").addClass("is-invalid");else if(""===n)B.message("ジャンルが正しく選択されていません","warning","#emalert"),$("#editGenre").addClass("is-invalid");else if(l===t&&n===o)B.message("変更なしになっています","warning","#emalert"),$("#editTitle").addClass("is-invalid"),$("#editGenre").addClass("is-invalid");else{var a=$("<div>"),i=$("<table>",{class:"mb-4"}),s=$("<tr>");s.append($("<td>",{text:"タイトル: "}));var c=$("<td>");if(c.append($("<strong>",{text:l})),t===l&&c.append($("<span>",{text:" (変更なし)"})),c.appendTo(s),s.appendTo(i),t!==l){var d=$("<tr>",{class:"gray"});d.append($("<td>",{text:"変更前: "})),d.append($("<td>",{text:t})),d.appendTo(i)}var p=$("<tr>");p.append($("<td>",{text:"ジャンル: ",class:"confirmedit"}));var g=$("<td>",{class:"confirmedit"});if(g.append($("<strong>",{text:n})),o===n&&g.append($("<span>",{text:" (変更なし)"})),g.appendTo(p),p.appendTo(i),o!==n){var u=$("<tr>",{class:"gray"});u.append($("<td>",{text:"変更前: "})),u.append($("<td>",{text:o})),u.appendTo(i)}a.append(i),a.append($("<span>",{text:"変更を保存しますか?"})),B.confAvoidable(a,function(){for(var e=Util.copyObj(B.y),t=e[o],a=[],i=0;i<t.length/2;i++)t[2*i]!==r?(a.push(t[2*i]),a.push(t[2*i+1])):o===n&&(a.push(r),a.push(l));e[o]=a,o!==n&&(e[n].push(r),e[n].push(l)),B.pushPrev(),B.y=e,B.messageUndoable("動画「"+l+"」の動画情報を更新しました","info",null,"v"),B.refresh("v"),$("#editModal").modal("hide"),$("#emalert").fadeOut()})}}),$("#editModal").on("hidden.bs.modal",function(){$("#editTitle").removeClass("is-invalid"),$("#editGenre").removeClass("is-invalid"),$("#emalert").html("")}),$("#nicolist_historyCount").on("change",function(e){var t=Util.int($(e.currentTarget).val());!isNaN(t)&&0<t&&localStorage.setItem("nicolist_historyCount",t+"")}),$("#nicolist_msc").on("change",function(e){var t=Util.int($(e.currentTarget).val());!isNaN(t)&&0<t&&localStorage.setItem("nicolist_msc",t+"")}),$("#nicolist_loop").on("change",function(){0!==$("#play iframe").length&&($("#nicolist_loop").prop("checked")?($("#pcloop img").attr("src",LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生を解除")):($("#pcloop img").attr("src",NOT_LOOP_DATA_URL),$("#pcloop").attr("title","ループ再生")),Util.registerTooltip($("#pcloop")),NicolistPlayer.refreshController())}),$("#nicolist_cinematic").on("change",function(){0!==$("#play iframe").length&&($("#nicolist_cinematic").prop("checked")?($("#pcwidth img").attr("src",NARROW_DATA_URL),$("#pcwidth").attr("title","固定サイズで表示")):($("#pcwidth img").attr("src",WIDEN_DATA_URL),$("#pcwidth").attr("title","ワイド画面で表示")),Util.registerTooltip($("#pcwidth")),NicolistPlayer.refreshController()),NicolistPlayer.videoResize()}),$("#searchQuery").on("focus",function(e){if(console.log(e.currentTarget),0!==B.searchHistory.length){$("#history").html("");for(var t=0;t<B.searchHistory.length;t++){var a=B.searchHistory[t];$("<a>",{text:a,class:"dropdown-item pointer",click:function(e){$("#searchQuery").val($(e.currentTarget).text()),B.search($("#searchQuery").val())}}).appendTo("#history")}$("#history").css({"min-width":$(e.currentTarget).outerWidth()+"px",display:"inline-block",top:$(e.currentTarget).offset().top+$(e.currentTarget).outerHeight(),left:$(e.currentTarget).offset().left})}}),$("#searchQuery").on("click",function(e){e.stopPropagation()}),$("#searchQuery").on("keypress",function(e){13===e.keyCode&&(B.search($("#searchQuery").val()),$("#searchQuery").blur(),$("#history").css("display","none"))}),$("#search").on("click",function(e){B.search($("#searchQuery").val())}),$("#sgopen").on("click",function(){$("#sggenre").html("");for(var e=Object.keys(B.y),t=0;t<e.length;t++){var a=e[t],i=$("<div>",{class:"sggwrapper "+(0!=t?"sgtarget":"")}).append($("<div>",{text:a,class:"sgg "+(0!=t?"":"sgdef")}));$("#sggenre").append(i)}$("#genreSortModal").modal("show"),Sortable.create($("#sggenre").get(0),{draggable:".sgtarget",animation:300})}),$("#submitGenreSort, #submitGenreSort2").on("click",function(){B.pushPrev();var i={};$(".sgg").each(function(e,t){var a=$(t).text();i[a]=B.y[a]}),B.y=i,B.refresh("g"),B.messageUndoable("ジャンルを並び替えしました","success",null,"g"),$("#genreSortModal").modal("hide")}),$("#issueRaw").on("click",function(){var e=new Date;Util.saveAsFile("backup_"+e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate()+".json",JSON.stringify(B.y))}),$("#fromRawFile").on("change",function(e){$("#loadrawalert").html("");var t=e.target.files;t&&1===t.length?/json/.test(t[0].type)?(B.fileToLoad=t[0],$("#rawFileName").text(B.fileToLoad.name),$("#loadRawJson").removeClass("silent"),$("#dummyLoadRawJson").addClass("silent")):B.message("jsonファイルを選択してください","warning","#loadrawalert"):B.message("正しいファイルを選択してください","warning","#loadrawalert")}),$("#loadRawJson").on("click",function(){if(B.fileToLoad){var p=new FileReader;p.readAsText(B.fileToLoad),p.onload=function(){try{if(p.result instanceof ArrayBuffer)var e=JSON.parse(p.result.toString());else e=JSON.parse(p.result)}catch(e){return void B.message("フォーマットが正しくありません","warning","#loadrawalert")}var t=0,a=0;if("object"===$.type(e)){for(var i=Util.copyObj(B.y),r=Object.keys(e),l=0;l<r.length;l++){var n=r[l],o=e[n];if("array"!==$.type(o))return void B.message("フォーマットが正しくありません","warning","#loadrawalert");for(var s=0;s<o.length/2;s++){var c=o[2*s],d=o[2*s+1];i.hasOwnProperty(n)||(i[n]=[],a++),-1===$.inArray(c,i[n])&&(i[n].push(c),i[n].push(d),t++)}}0===t&&0===a?B.message("すべて登録済みの動画です","warning","#loadrawalert"):(B.pushPrev(),B.y=i,B.messageUndoable("JSONから"+(0<t?t+"個の動画":"")+(0<a&&0<t?"、":"")+(0<a?a+"個のジャンル":"")+"を新たに読み込みました","success",null,(0<a?"g":"")+(0<t?"v":"")),B.refresh((0<a?"g":"")+(0<t?"v":"")),$("#loadrawalert").fadeOut(),$("#prefModal").modal("hide"))}else B.message("フォーマットが正しくありません","warning","#loadrawalert")},B.fileToLoad=null,$("#rawFileName").text(""),$("#loadRawJson").addClass("silent"),$("#dummyLoadRawJson").removeClass("silent")}})},B.init=function(){(NicolistPlayer.showFavbutton=!0,B.registerEventListener(),Util.isNull(localStorage))&&(Util.isNull(document.cookie)?B.message("ローカルストレージ・Cookieが利用できないためデータを保存することができません。","danger",null,!0):(localStorage=new function(){var i=this;this.data={},this.length=0,this.getItem=function(e){return i.data[e]},this.setItem=function(e,t){if(null!==e){i.data.hasOwnProperty(e)||i.length++;var a=new Date;a.setTime(Date.now()+687084e4),document.cookie="ls_"+escape(e)+"="+escape(t)+"; expires="+a.toUTCString()+"; path=/",i.data[e]=t}},this.removeItem=function(e){null!==e&&(document.cookie="ls_"+escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",i.data.hasOwnProperty(e)&&(i.length--,delete i.data[e]))},this.clear=function(){i.data={},i.length=0},this.key=function(e){return Object.keys(i.data)[e]},this.length=0,this.data={};var e=document.cookie.match(/ls_[^=;]+=[^;=]*/g);if(null!==e)for(var t=0;t<e.length;t++){var a=e[t].split(/=/);this.data[unescape(a[0].substring(3))]=a[1]}},""===document.cookie&&B.message("お使いのブラウザはローカルストレージをサポートしていないため、代わりにcookieを使用してデータを保存しています。","warning")));B.islocal&&$("#local_indicator").removeClass("silent"),B.initDataFromLS(),Util.registerTooltip($("#controller span[title]")),B.refresh("vgs")},B.initDataFromLS=function(){$("input[type=checkbox]").each(function(e,t){var a=$(t).attr("id");if(!Util.isNull(a)){var i=window.localStorage.getItem(a);"true"===i?$(t).prop("checked",!0):i&&$(t).prop("checked",!1)}}),Util.getLS("nicolist_separator",function(e){$("#nicolist_separator").val(e)},function(){$("#nicolist_separator").val(B.SEP_DEF_VAL)}),Util.getLS("nicolist_ignore",function(e){$("#nicolist_ignore").val(e)},function(){$("#nicolist_ignore").val(B.IGN_DEF_VAL)}),Util.getLS("nicolist_click_action",function(e){""!==e&&$("#click_action").val(e)}),Util.getLSInt("_nicolistTabCount",function(e){if(!$("#nicolist_multitab").prop("checked")){var t=$("<span>");$("<span>",{text:"正しく終了されませんでしたか？",class:"undo ml-1 mr-1",click:function(){localStorage.setItem("_nicolistTabCount","1"),$("#alert").fadeOut("slow",B.refreshStyle)}}).appendTo(t),$("<span>",{text:"/",class:"ml-1 mr-1"}).appendTo(t),$("<span>",{text:"このアラートが常に表示される場合",class:"undo ml-1",click:function(){$("#nicolist_multitab").prop("checked",!0),localStorage.setItem("nicolist_multitab","true"),$("#laert").fadeOut("slow",B.refreshStyle)}}).appendTo(t),B.message("複数タブで同時に閲覧している可能性があります。","danger",null,!0,t)}localStorage.setItem("_nicolistTabCount",e+1+"")},function(){localStorage.setItem("_nicolistTabCount","1")}),Util.getLS("nicolist",function(t){try{if("object"!=typeof(t=JSON.parse(t)))throw new Error("JSON syntax error");B.y=t}catch(e){console.error("JSON Systax Error: "+t+" is not a json"),console.error(e)}}),Util.getLS("selectedGenre",function(e){B.setSelGen(e)},function(){0<Object.keys(B.y).length&&B.setSelGen(Object.keys(B.y)[0])}),Util.getLS("nicolist_ccnewval",function(e){$("#ccnew").val(e),"copytoold"===e||"movetoold"===e?($("#ccnewform").css("display","none"),$("#ccoldform").css("display","block")):($("#ccnewform").css("display","block"),$("#ccoldform").css("display","none")),"copytoold"===e||"copytoold"===e?$("#createcopy, #createcopy2").text("コピー"):$("#createcopy, #createcopy2").text("移動")}),Util.getLS("searchHistory",function(t){try{B.searchHistory=JSON.parse(t),"array"!==$.type(B.searchHistory)&&(B.searchHistory=[])}catch(e){console.error("JSON Systax Error: "+t+" is not a json"),console.error(e)}}),Util.getLSInt("nicolist_historyCount",function(e){$("#nicolist_historyCount").val(e)}),Util.getLS("nicolist_msc",function(e){$("#nicolist_msc").val(e)}),Util.getLS("nicolist_deleted",function(t){try{NicolistPlayer.deletedVideoArray=JSON.parse(t),"array"!==$.type(NicolistPlayer.deletedVideoArray)&&(NicolistPlayer.deletedVideoArray=[])}catch(e){console.error("JSON Systax Error: "+t+" is not a json"),console.error(e)}}),Util.getLS("nicolist_star",function(t){try{B.starred=JSON.parse(t),"array"!==$.type(B.starred)&&(B.starred=[])}catch(e){console.error("JSON Systax Error: "+t+" is not a json"),console.error(e)}}),Util.getLS("nicolist_volumemap",function(t){try{t=JSON.parse(t),"object"===$.type(t)&&(NicolistPlayer.volumemap=t)}catch(e){console.error("JSON Systax Error: "+t+" is not a json"),console.error(e)}})},B.unload=function(){var e=Util.int(localStorage.getItem("_nicolistTabCount"));1===e?localStorage.removeItem("_nicolistTabCount"):2<=e&&localStorage.setItem("_nicolistTabCount",e-1+"")},B.refresh=function(e){B.y.hasOwnProperty(B.selectedGenre)||B.setSelGen("とりあえず");var t=-1!==e.indexOf("v"),a=-1!==e.indexOf("g"),i=-1!==e.indexOf("s");if(i&&($("#favs li").hasClass("selected")&&$("#favs li").removeClass("selected"),B.refreshFavsLeft()),i||a){$("select[role='genre']").html(""),$("#left").html("");var r=function(a){$("select[role='genre']").each(function(e,t){$(t).append($("<option>",{value:a,text:a}))}),$("<li>",{class:a===B.selectedGenre?"list-group-item selected":"list-group-item",text:a,click:function(e){var t=$(e.currentTarget).text();B.setSelGen(t),B.refresh("s")}}).appendTo("#left")};for(var l in B.y)r(l);$('select[role="genre"]').val(B.selectedGenre)}if(i||a||t)if($("#right").html(""),$("#favs li").hasClass("selected"))B.showFavs();else{$("#nicolist_thumb").prop("checked");"とりあえず"===B.selectedGenre?$("<h4>",{text:B.selectedGenre}).append($("<small>",{class:"text-muted ml-2",text:"("+B.y[B.selectedGenre].length/2+")"})).appendTo("#right"):$("<h4>",{text:B.selectedGenre}).append($("<small>",{class:"text-muted ml-2 mr-1",text:"("+B.y[B.selectedGenre].length/2+")"})).append($("<small>",{class:"removevideo","data-genre":B.selectedGenre,title:"ジャンルを削除",text:"×",click:function(e){B.removeGenre($(e.currentTarget))}})).appendTo("#right");var n=B.y[B.selectedGenre];$("#nicolist_sort").prop("checked")&&(n=B.reversePairList(n));for(var o=Math.ceil($(window).height()/68),s=0;s<n.length/2;s++){var c=n[2*s],d=n[2*s+1];B.rightVideoElem(c,d,B.selectedGenre,o<s).appendTo("#right")}}(a||t)&&($("#out").val(JSON.stringify(B.y,null,"    ")),localStorage.setItem("nicolist",JSON.stringify(B.y)),$("#length").text("("+B.sizeString(Util.bytesize(JSON.stringify(B.y)))+")"),""!==$("#sr").html()&&B.search(B.searchHistory[0]))},B.refreshFavsLeft=function(){0<B.starred.length?$("#favs").removeClass("disabled"):$("#favs").addClass("disabled"),$("#favlen").text(B.starred.length/2+"")},B.showFavs=function(){$("#left .selected").removeClass("selected"),$("#favs li").addClass("selected"),B.constructRightFav()},B.constructRightFav=function(){$("#right").html("");$("#nicolist_thumb").prop("checked");$("<h4>",{text:"お気に入り"}).append($("<small>",{text:"×",class:"removevideo",title:"お気に入りをクリア",click:function(){B.confirm("お気に入りをクリアしますか?",function(){B.starred=[],B.refreshFavsLeft(),""!==$("#play").html()&&NicolistPlayer.refreshController(),$(".favIcon").each(function(e,t){$(t).attr("src",UNSTAR_DATA_URL)}),B.refresh("s"),localStorage.setItem("nicolist_star",JSON.stringify(B.starred))})}})).appendTo("#right");var e=B.starred;$("#nicolist_sort").prop("checked")&&(e=B.reversePairList(e));for(var t=Math.ceil($(window).height()/68),a=0;a<e.length/2;a++){var i=e[2*a],r=e[2*a+1];B.rightVideoElem(i,r,"",t<a).appendTo("#right")}},B.toggleFav=function(e,t){for(var a=-1,i=0;i<B.starred.length;i+=2){if(B.starred[i]===e){a=i;break}}return-1===a?(B.starred.push(e),B.starred.push(t),$(".favIcon[data-id="+e+"]").each(function(e,t){$(t).attr("src",STAR_DATA_URL),B.startStarAnimation($(t))}),$("#favs li").hasClass("selected")&&0===$("#right a[data-id="+e+"]").length&&($("#nicolist_sort").prop("checked")?B.rightVideoElem(e,t,"",!1).insertAfter("#right h4"):$("#right").append(B.rightVideoElem(e,t,"",!1))),!0):(B.starred.splice(a,2),$(".favIcon[data-id="+e+"]").each(function(e,t){$(t).attr("src",UNSTAR_DATA_URL)}),!1)},B.rightVideoElem=function(e,t,a,i){var r=$("<div>",{class:"d-flex flex-row align-items-center"}),l=B.createFavIcon(e,t),n=$("<a>",{href:B.getVideoURL(e),target:"_blank","data-genre":a,"data-id":e,"data-title":t,class:"rightvideo",contextmenu:function(e){return B.showMenu(e.pageX,e.pageY,$(e.currentTarget),"right"),!1},click:function(e){"official"!==$("#click_action").val()&&e.preventDefault(),B.openVideo($(e.currentTarget),"right")}});if(r.append(l),$("#nicolist_thumb").prop("checked")||r.addClass("mb-2"),$("#nicolist_thumb").prop("checked")&&(i?n.append(B.createStayUnloadedTNI(e,!1)):n.append(B.createThumbImgElem(e,!1))),$("#nicolist_taggedtitle").prop("checked")){var o=t.match(/【[^【】]+】/g),s=t.match(/\[[^\[\]]+\]/g),c=[],d=t;if(null!==o){for(var p=0;p<o.length;p++)c.push(o[p]);d=d.replace(/【[^【】]+】/g,"")}if(null!==s){for(p=0;p<s.length;p++)c.push(s[p]);d=d.replace(/\[[^\[\]]+\]/g,"")}d=d.replace(/^\s+/g,"").replace(/\s+$/g,""),n.append($("<span>",{text:d,class:"mr-2"})),n.appendTo(r);for(p=0;p<c.length;p++)r.append($("<span>",{text:c[p].slice(1,-1),class:"titletag ml-1",click:function(e){$("#search").val($(e.currentTarget).text()),B.search($(e.currentTarget).text());var t=$("#sr").offset().top-16;t<$("html,body").scrollTop()&&$("html,body").stop().animate({scrollTop:t},"swing")}}))}else n.append($("<span>",{text:t})),n.appendTo(r);return r},B.openVideo=function(e,t){var a=e.attr("data-id"),i=e.attr("data-title"),r=(e.attr("data-genre"),$("#click_action").val());if("thispage"===r)$("#play").html(""),NicolistPlayer.playindex=0,NicolistPlayer.playlist=[a],NicolistPlayer.playlistTitleMap={},NicolistPlayer.playlistTitleMap[a]=i,B.islocal?window.open(Util.domain+"/player.html?pl="+escape(JSON.stringify(NicolistPlayer.playlist))+"&i="+NicolistPlayer.playindex):(NicolistPlayer.createEmbedElem(),NicolistPlayer.refreshController());else if("cont"===r||"randomcont"===r){if($("#play").html(""),"right"===t)NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#right a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")});else if("random"===t)NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#randomVideo a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")});else{if("search"!==t)return;NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#sr a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")})}"randomcont"===r&&(NicolistPlayer.playlist=Util.shuffle(NicolistPlayer.playlist,a)),NicolistPlayer.playindex=$.inArray(a,NicolistPlayer.playlist),-1===NicolistPlayer.playindex&&(NicolistPlayer.playindex=0),B.islocal?window.open(Util.domain+"/player.html?pl="+escape(JSON.stringify(NicolistPlayer.playlist))+"&i="+NicolistPlayer.playindex):(NicolistPlayer.createEmbedElem(),NicolistPlayer.refreshController()),$("html,body").stop().animate({scrollTop:0},"swing")}},B.sizeString=function(e){return e<500?e+" byte":e<5e5?Math.round(100*e/1024)/100+" KB":e<5e8?Math.round(100*e/1024/1024)/100+" MB":Math.round(100*e/1024/1024/1024)/100+" GB"},B.showMenu=function(e,t,r,l){var n=r.attr("data-id"),o=r.attr("data-genre"),s=r.attr("data-title"),c=r.attr("href");$("#menu").children("a").each(function(e,t){var a=$(t).attr("role");if("title"===a)if(c){$(t).html("");var i=$("<a>",{href:c,text:s,target:"_blank"});$(t).append(i)}else $(t).text(s);else"remove"===a?o?($(t).on("click",function(){B.removeVideo(r),B.closeMenu()}),$(t).hasClass("disabled")&&$(t).removeClass("disabled")):$(t).hasClass("disabled")||$(t).addClass("disabled"):"edit"===a?o?($(t).on("click",function(){var e=r.attr("data-id"),t=r.attr("data-title"),a=r.attr("data-genre");$("#editThumb").attr("src",B.getThumbURL(e)),$("#editUrl").text(e),$("#editUrlLink").attr("href",B.getVideoURL(e)),$("#editTitle").val(t),$("#editGenre").val(a),$("#saveEdit").attr("data-title",t),$("#saveEdit").attr("data-genre",a),$("#editModal").modal(),B.closeMenu()}),$(t).removeClass("disabled")):$(t).addClass("disabled"):"play"===a?$(t).on("click",function(){$("#play").html(""),NicolistPlayer.playindex=0,NicolistPlayer.playlist=[n],NicolistPlayer.playlistTitleMap={},NicolistPlayer.playlistTitleMap[n]=s,B.islocal?window.open(Util.domain+"/player.html?pl="+escape(JSON.stringify(NicolistPlayer.playlist))+"&i="+NicolistPlayer.playindex):(NicolistPlayer.createEmbedElem(),NicolistPlayer.refreshController()),B.closeMenu()}):"playall"!==a&&"playall-random"!==a||$(t).on("click",function(){if($("#play").html(""),"right"===l)$(t).removeClass("disabled"),NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#right a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")});else if("random"===l)$(t).removeClass("disabled"),NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#randomVideo a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")});else{if("search"!==l)return void $(t).addClass("disabled");$(t).removeClass("disabled"),NicolistPlayer.playlist=[],NicolistPlayer.playlistTitleMap={},$("#sr a[data-id]").each(function(e,t){var a=$(t).attr("data-id");NicolistPlayer.playlist.push(a),NicolistPlayer.playlistTitleMap[a]=$(t).attr("data-title")})}"playall-random"===a&&(NicolistPlayer.playlist=Util.shuffle(NicolistPlayer.playlist,n)),NicolistPlayer.playindex=$.inArray(n,NicolistPlayer.playlist),-1===NicolistPlayer.playindex&&(NicolistPlayer.playindex=0),B.islocal?window.open(Util.domain+"/player.html?pl="+escape(JSON.stringify(NicolistPlayer.playlist))+"&i="+NicolistPlayer.playindex):(NicolistPlayer.createEmbedElem(),NicolistPlayer.refreshController()),$("html,body").stop().animate({scrollTop:0},"swing"),B.closeMenu()})}),$("#menu").css({display:"inline-block",top:t,left:e}),B.showingMenu=!0},B.closeMenu=function(){$("#menu").css("display","none"),B.showingMenu=!1},B.has=function(e,t){for(var a=B.y[e],i=0;i<a.length/2;i++)if(a[2*i]===t)return!0;return!1},B.addGenre=function(e){return 64<Util.bytesize(e)?(B.message("ジャンル名は64バイト以内に収める必要があります","warning","#alert-genre"),!1):0===Util.bytesize(e)?(B.message("作成するジャンルの名前を入力してください。","warning","#alert-genre"),!1):B.y.hasOwnProperty(e)?(B.message("ジャンル「"+e+"」は既に存在しているようです。","warning","#alert-genre"),!1):(B.pushPrev(),B.y[e]=[],$("#alert-genre").fadeOut(),B.messageUndoable("ジャンル「"+e+"」を追加しました","success",null,"gs"),!0)},B.removeVideo=function(e){var i=e.attr("data-genre"),r=e.attr("data-id"),l=e.attr("data-title");B.confAvoidable("本当に動画「"+Util.cutString(l,50)+"」を削除しますか？",function(){B.pushPrev();for(var e=B.y[i],t=[],a=0;a<e.length/2;a++)e[2*a]!==r&&(t.push(e[2*a]),t.push(e[2*a+1]));B.y[i]=t,B.messageUndoable("動画「"+Util.cutString(l,50)+"」を削除しました","danger",null,"v"),B.refresh("v")})},B.removeGenre=function(e){var a=e.attr("data-genre");B.confirm("本当にジャンル「"+a+"」を削除しますか？\n"+B.y[a].length/2+"個の動画が登録されています。",function(){var e={};for(var t in B.pushPrev(),B.y)a!==t&&(e[t]=B.y[t]);B.y=e,B.messageUndoable("ジャンル「"+a+"」を削除しました","danger",null,"gs"),B.setSelGen(Object.keys(B.y)[0]),B.refresh("gs")})},B.setSelGen=function(e){if(!B.y.hasOwnProperty(e))return B.setSelGen(Object.keys(B.y)[0]),void B.message("前回選択していたジャンルの引き継ぎ時にエラーが発生しました","danger");B.selectedGenre=e,localStorage.setItem("selectedGenre",B.selectedGenre)},B.redo=function(e){var t=Util.copyObj(B.y);B.y=Util.copyObj(B.prevy),B.prevy=t,B.messageUndoable("やり直しました","primary",e.attr("data-wrapper"),e.attr("data-refarg")),B.refresh(e.attr("data-refarg"))},B.undo=function(e){var t=Util.copyObj(B.y);B.y=Util.copyObj(B.prevy),B.prevy=t,B.messageUndoable("もとに戻しました","primary",e.attr("data-wrapper"),e.attr("data-refarg"),null,"redo"),B.refresh(e.attr("data-refarg"))},B.message=function(e,t,a,i,r){void 0===t&&(t="warning"),void 0===a&&(a="#alert"),void 0===i&&(i=!1),-1===$.inArray(t,B.MESSAGE_TYPES)&&(t="warning"),""!==a&&0!==$(a).length||(a="#alert");var l=$("<div>",{class:"alert alert-"+t}).css("display","none");i||$("<button>",{type:"button",class:"close"}).append($("<span>",{html:"&times;",click:function(e){$(e.currentTarget).parent().parent().fadeOut("slow",B.refreshStyle)}})).appendTo(l);var n=$("<span>",{text:e});r&&n.append(r),n.appendTo(l),$(a).html(""),$(a).append(l),l.fadeIn()},B.messageUndoable=function(e,t,a,i,r,l){var n;i=i||"",n="redo"===l?$("<span>",{text:"[やり直す]",class:"undo","data-wrapper":a,"data-refarg":i,click:function(e){B.redo($(e.currentTarget))}}):$("<span>",{text:"[もとに戻す]",class:"undo","data-wrapper":a,"data-refarg":i,click:function(e){B.undo($(e.currentTarget))}}),B.message(e,t,a,r,n)},B.confAvoidable=function(e,t){$("#nicolist_del").prop("checked")?t():"string"===$.type(e)?B.confirm($("<span>",{text:e}),t):B.confirm(e,t)},B.confirm=function(e,t,a){$("#confDialog").html(""),$("#confDialog").append(e),$("#confOK").html("").append($("<button>",{text:"はい",class:"btn btn-primary",click:t,"data-dismiss":"modal"}));var i=$("<button>",{text:"キャンセル",class:"btn btn-secondary","data-dismiss":"modal"});null!==a&&i.on("click",a),$("#confDeny").html("").append(i),$("#confModal").modal("show")},B.pushPrev=function(){B.prevy=Util.copyObj(B.y)},B.randomFromAll=function(){var e={},t=0;for(var a in B.y)e[a]=B.y[a].length,t+=e[a];if(0!==t)for(var i=Math.random()*t,r=0,l=Object.keys(e),n=0;n<l.length;n++){var o=l[n];if(r<i&&r+e[o]>=i){B.random(B.y[o],o);break}r+=e[o]}else B.message("まだ一つも動画が登録されていません")},B.random=function(e,t){if(0!==e.length){var a=Math.floor(Math.random()*(e.length/2)),i=e[2*a],r=e[2*a+1];$("#nicolist_rand").prop("checked")&&$("#randomVideo").html(""),0===$("#random button").length&&$("<button>",{type:"button",class:"close"}).append($("<span>",{html:"&times;",click:function(e){$("#random").fadeOut("slow",function(){B.refreshStyle(),$("#randomVideo").html("")})}})).prependTo("#random");var l=$("<a>",{href:B.getVideoURL(i),target:"_blank","data-genre":t,"data-id":i,"data-title":r,contextmenu:function(e){return B.showMenu(e.pageX,e.pageY,$(e.currentTarget),"random"),!1},click:function(e){"official"!==$("#click_action").val()&&e.preventDefault(),B.openVideo($(e.currentTarget),"random")}}),n=$("<div>",{class:"d-flex align-items-center flex-row"}),o=B.createFavIcon(i,r);n.append(o),$("#nicolist_thumb_res").prop("checked")&&l.append(B.createThumbImgElem(i,$("#nicolist_rand").prop("checked")));var s=$("<span>",{text:r});l.append(s),n.append(l),null!==t&&n.append($("<span>",{text:"("+t+")",class:"ml-2 text-muted"})),n.prependTo("#randomVideo"),$("#random").css("display","block")}else B.message("まだ一つも動画が登録されていません")},B.randomFromRight=function(){var i=[],r=null;$("#right a[data-id]").each(function(e,t){if(i.push($(t).attr("data-id")),i.push($(t).attr("data-title")),null==r){var a=$(t).attr("data-genre");Util.isNull(a)||(r=a)}}),B.random(i,r)},B.refreshStyle=function(){"none"!==$("#history").css("display")&&$("#history").css({top:$("#searchQuery").offset().top+$("#searchQuery").outerHeight(),left:$("#searchQuery").offset().left,"min-width":$("#searchQuery").outerWidth()})},B.createThumbImgElem=function(e,t){var a=$("<img>",{src:B.getThumbURL(e),alt:"No Image",class:"mr-4 img-thumbnail loading "+(t?"full-thumb":"sm-thumb")});return a.on("load",function(e){-1===$.inArray($(e.currentTarget).attr("src"),B.loadedtn)&&B.loadedtn.push($(e.currentTarget).attr("src")),$(e.currentTarget).removeClass("loading")}),a},B.createStayUnloadedTNI=function(e,t){var a=B.getThumbURL(e);return-1===$.inArray(a,B.loadedtn)?$("<img>",{"data-src":a,alt:"No Image",class:"mr-4 img-thumbnail loading "+(t?"full-thumb":"sm-thumb")}):B.createThumbImgElem(e,t)},B.reversePairList=function(e){for(var t=[],a=e.length/2-1;0<=a;a--)t.push(e[2*a]),t.push(e[2*a+1]);return t},B.$starImg=function(e){return(e?$("<img>",{src:STAR_DATA_URL}):$("<img>",{src:UNSTAR_DATA_URL})).addClass("favIcon")},B.startStarAnimation=function(e){var t=e.offset().left-e.width()/2,a=e.offset().top-e.height()/2,i=$("<img>",{width:"32px",height:"32px",src:LARGE_STAR_DATA_URL}),r=$("<div>",{id:"starAnime"}).css({top:a,left:t});r.append(i),$("#body").append(r),i.animate({width:"2px",height:"2px",opacity:0,"margin-left":"15px","margin-top":"15px"},300,function(){$("#starAnime").remove()})},B.createFavIcon=function(e,t){for(var a=-1,i=0,r=B.starred.length;i<r;i+=2){if(B.starred[i]===e){a=i;break}}var l=B.$starImg(-1!==a);return l.addClass("mr-2 pointer").attr({title:"お気に入り","data-id":e,"data-title":t}).on("click",function(e){var t=$(e.currentTarget).attr("data-id"),a=$(e.currentTarget).attr("data-title");B.toggleFav(t,a),B.refreshFavsLeft(),localStorage.setItem("nicolist_star",JSON.stringify(B.starred))}),l},B.MESSAGE_TYPES=["primary","secondary","success","danger","warning","info","light","dark"],B.SEP_DEF_VAL=" 　+",B.IGN_DEF_VAL="",B.debug=!1,B.y={"とりあえず":[]},B.prevy={"とりあえず":[]},B.searchHistory=[],B.selectedGenre="",B.showingMenu=!1,B.islocal=!B.debug&&"file:"===window.location.protocol,B.starred=[],B.lastId="",B.loadedtn=[],B}();